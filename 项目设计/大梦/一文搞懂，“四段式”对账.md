#review/对账系统 
> 本文深入探讨了现代支付系统中的“四段式对账”机制，详细解释了账务数据、支付数据、清算数据和结算数据之间的核对关系及其重要性。阅读本文，你将全面理解支付对账的核心逻辑和实施细节，希望对你有所帮助。

![](https://image.woshipm.com/2023/10/11/74deb480-67cf-11ee-99ad-00163e142b65.jpg)

无论在哪套体系里，对账体系都是非常重要的一环，而且是一环扣一环

同一笔交易，在一个机构内部会产生多套数据，这些数据之间存在核对关系，他们的核对关系，可以称为”四段式对账“

什么是”四段式对账“，这里的四段指的是”四段数据”，”四段式对账“就是指这四段数据的相互核对，如下图

![](https://image.woshipm.com/2024/05/09/2a4b170e-0da3-11ef-b3fd-00163e142b65.png)

## 一、有哪四段数据

四段数据即“账务数据、支付数据、清算数据、结算数据”，这是对账的核心数据，他们之间存在如下的相生关系

![](https://image.woshipm.com/2024/05/10/1bf35ec6-0ea4-11ef-b3fd-00163e142b65.png)

从下面这张图中可以更清晰的看出来交易驱动支付和账务，支付驱动渠道，渠道自身生成清算记录和结算记录

![](https://image.woshipm.com/2024/05/09/28e7acd8-0da3-11ef-b3fd-00163e142b65.jpg)

只不过这里要清楚这样一个问题，交易在驱动账务过程中经过了“计费”，也就是商户手续费、以及通道成本费用，那么这两部分费用原则上至少要在资金对账环节参与核对，甚至在明细核对环节也可以参与核对，具体看开头推荐到“对账长文”

回头看这四段数据，如何标记这四段数据，也就是可以通过一个标记方法，轻松识别是什么数据，比如你可以把账务数据叫张三，支付数据叫李四，渠道数据叫王五，渠道结算数据叫老六

但是，这样做很明显并不太好用于交流和系统之间的数据传递

还有一种方法就是通过一组数字编码实现，同时，同一段数据，如支付数据，又存在支付、退款、打款、打款退回等子类，那么至少在编码上可以实现多维度的分类，先看两个编码设计例子

### 1）就像国家一级科目编号一样

- 资产类：1001是库存现金，1002是银行存款
- 负债类：2001是短期借款
- 所有者权益类：4001是实收资本，4002是资本公积

### 2）同样看二代系统对业务编码的设计规则

![](https://image.woshipm.com/2024/05/10/1c4f839a-0ea4-11ef-b3fd-00163e142b65.png)

通过这样的规则，就得到了下面的业务编码

![](https://image.woshipm.com/2024/05/10/1c9239d8-0ea4-11ef-b3fd-00163e142b65.png)

### 3）数据段编码设计

受上述编码设计的启发，我们也可以这么来编排各段数据，这样就得到了四段数据的编码规则

![](https://image.woshipm.com/2024/05/10/19fe99aa-0ea4-11ef-b3fd-00163e142b65.png)

根据实际业务种类例如收款、退款、打款、打款退回，分别分配各段数据的编码（图中234段数据，第一位改成对应段数）

![](https://image.woshipm.com/2024/05/10/1ea0c3f2-0ea4-11ef-b3fd-00163e142b65.png)

这样的话，四段数据就确定了

基于这样的思路，如果有了更多业务，或者新的数据种类，可以继续增加到5段数据，6段数据，7段数据，8段数据……

## 二、四段数据就会产生三组核对

前面我们介绍了4段数据，那么根据他们相生关系，就可以产生三段核对关系

![](https://image.woshipm.com/2024/05/10/1a3f529c-0ea4-11ef-b3fd-00163e142b65.png)

### 1）账务对账

这是支付记录和账务记录的核对，确保所有商户发起的支付请求，都完成的账务记录，因为商户结算是基于账务数据进行的，因此只有保证支付到账务的数据维持一致，那么给商户的结算才能正确

账务对账的含义是：我的支付记录是不是都入账了

### 2）交易对账

是平台的支付记录与渠道的支付记录（渠道清算数据）的核对，这一环节是确保我这边记录的支付情况，与渠道的支付清算是一致的，从原理上支付是平台发起的，但支付处理结果是有渠道通知的，这两边要保持一致

那么交易对账的含义就是：我的记录和渠道的记录是否一致

### 3）资金对账

平台向渠道提交了支付请求，渠道生成了渠道自身的支付记录，也就是平台拿到的清算文件，有的也叫“交易记录”，即平台的“应收应付”

渠道最终会基于清算记录做向平台的资金结算


那么资金对账的含义是：渠道应该结给我的钱，是不是都结算了？

这里给大家提出一个面试题：账务数据结算至商户结算户以后，那么这一步搬运也是有可能产生差错的，你打算怎么办？

## 三、衍生出3套差错

有对账就有差错，也就是对不平，两份数据存在不一致，你有我没有，我有你没有，你有我有就是不一样，状态不一样、金额不一样等

既然我们有4段数据，3段核对，那必然就会产生3套差错

![](https://image.woshipm.com/2024/05/10/1a7be194-0ea4-11ef-b3fd-00163e142b65.png)

### 1）账务差错——多入或者少入

即账务数据和支付数据核对出现的不一致，也就是没有正确入账的数据，少入账商家不答应，多入账平台太委屈

所以，公平起见，是多少就是多少，一分不多，一分不少

### 2）交易差错——对平、单边或者错账

即平台支付数据与渠道清算数据之间的核对，也就是我请求你的你都记了，你通知我的我也都正确更新了

那么这个核对环节就是会产生交易差错，即单边账或者错账，单边账就是一方有一方没有，错账就是两边都有但是金额不一致

### 3）资金差错——长款或者短款

即应收应付和实收实付的核对，这是非常重要的一环核对，因为关系到平台自身有没有拿到该拿的钱，有没有付出不该付出的资金

简单的说就是有没有少收钱，有没有多付钱；少收钱对不起商户，多付钱对不起自己

总之，金钱无小事，一分不能差

## 四、差错衍生出的数据段

大家有没有发现，原来的四段数据在经过3组核对以后产生了差错数据，如果要对差错进行处理，又产生了差错处理数据

![](https://image.woshipm.com/2024/05/10/207e8bc8-0ea4-11ef-b3fd-00163e142b65.png)

这样的话，就会产生新的数据，一种衍生的数据，这些数据他也是数据，也配有“名分”，看上图中对应的数据“段”分配的值

这里要注意，单边账并不是新的数据，还是原来的支付数据和渠道清算数据，只不过对方没有而已

但是，当你对单边发起差错处理时会产生新的数据，例如“渠道单边-平台补单”，为了区别与正常平台数据的差异，可以另起段位，来区分这个数据是对账后补的数据

## 五、这些数据“段”的用途

这些数据的有很大的用途，在后续数据传递，会计记账过程中承担的重要的角色

当你看到数据的“编号”时，你就知道这是什么数据，存在那个系统里，是怎么产生的，在清结算账务处理环节要操作哪些账户，会计核算系统要生成什么样的凭证

![](https://image.woshipm.com/2024/05/10/2116a9da-0ea4-11ef-b3fd-00163e142b65.png)

例如，用户支付了2笔，各10元，成功了1笔，另一笔支付处理中，支付核心生成支付数据

![](https://image.woshipm.com/2024/05/09/3073f858-0da3-11ef-b3fd-00163e142b65.png)

交易驱动账务进行记账，以该数据为记账数据，按照上图，支付记录是2段数据，收款数据是2001，2001 数据的会计分录规则是

![](https://image.woshipm.com/2024/05/10/1b020af8-0ea4-11ef-b3fd-00163e142b65.png)

即 数据={支付成功，2001，10元}，生成凭证如下

借 清算往来-收 10元

贷 商户待结算  10元

用图例表述如下图所示：

![](https://image.woshipm.com/2024/05/09/30b64a82-0da3-11ef-b3fd-00163e142b65.png)

或者

![](https://image.woshipm.com/2024/05/10/1b71f8e0-0ea4-11ef-b3fd-00163e142b65.png)

# Reference
https://www.woshipm.com/share/6054710.html