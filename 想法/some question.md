一面  
1.线程池由哪些组件组成，有哪些线程池，分别怎么使用，以及拒绝策略有哪些    
4.什么时候多线程会发生死锁，写一个例子  
5.说一说 jdk1.8 中，对 hashMap 的优化，对 concurrentHashMap 的优化  
6.如何解决 hash 冲突的，以及如果冲突了，怎么在 hash 表中找到目标值  
7.有 1000 个数据存在 hashmap 中，实际的数量是多少，考虑负载因子和扩容  
8.常见的 RPC 有哪些？对应的区别和性能比较？  

三面  

2.网络编程 nio 和 netty 相关， netty 的线程模型，零拷贝实现  

四面（HR）  
1.为什么跳槽?  
2.期望薪酬？  
3.如何看待加班问题？  
4.平时自己是怎么学习技术的，除了 Java 相关，还会去了解其他什么技术？  
5.未来几年有什么规划？  

一面：  
1、介绍下自己  
2、介绍下最近觉得比较有难度的项目，并针对项目提出相关问题（Hbase 的 RowKey 是如何  
设计的等）  
3、在工作中什么地方用到了 MQ、 Redis  
4、介绍下 Java 集合  
5、 HashMap 如何扩容？扩容过程中有请求过来会发生什么？有哪些方式可以解决哈希冲突  
6、深拷贝和浅拷贝  
7、 Java 的线程同步有哪些方法（也就是 Java 锁有哪些）  
8、可重入锁了解吗？ Synchronized 和 ReentrantLock 的区别  
9、悲观锁和乐观锁， Java 中的悲观锁和乐观锁有哪些  
10、代码考核：链表求和。给定一个链表 L1、 L2，每个元素是为 10 以内的正整数，链表表  
示一个数字，表头为高位。求两个链表之和，以链表形式返回。如： L1:5->6->2,L2:1->7->0，  
和为 562+170=732  
11、 Spring 是如何实现事务的， Spring 事务的传播性，同一个类里面有两个方法，方法 A 和  
方法 B，方法 A 调用方法 B，方法 B 是事务，事务能生效吗，也就是说事务的原子性还有保  
证吗  
12、介绍一下 CAS 和 AQS？ AQS 的实现有哪些  
13、有没有做过大数据处理方面的工作

三：⾯试官提问的部分问题： 这些问题我都会结合⽂字+流程图/原理图 做⾮常深⼊的解答  
问题：简述HashMap的底层原理  
（1）hash算法：为什么要⾼位和低位做异或运算？答：让⾼位也参与hash寻址运算，降低hash冲突  
（2）hash寻址：为什么是hash值和数组.length - 1进⾏与运算？答：因为取余算法效率很低，按位与运  
算效率⾼  
（3）hash冲突的机制：链表，超过8个以后，红⿊树（数组的容量⼤于等于64）

（4）扩容机制：数组2倍扩容，重新寻址（rehash），hash & n - 1，判断⼆进制结果中是否多出⼀个  
bit的1，如果没多，那么就是原来的index，如果多了出来，那么就是index + oldCap，通过这个⽅式。就  
避免了rehash的时候，⽤每个hash对新数组.length取模，取模性能不⾼，位运算的性能⽐较⾼  
JDK 1.8以后，优化了⼀下，如果⼀个链表的⻓度超过了8，就会⾃动将链表转换为红⿊树，查找的性能，  
是O(logn)，这个性能是⽐O(n)要⾼的  
（5）红⿊树是⼆叉查找树，左⼩右⼤，根据这个规则可以快速查找某个值  
（6）但是普通的⼆叉查找树，是有可能出现瘸⼦的情况，只有⼀条腿，不平衡了，导致查询性能变成  
O(n)，线性查询了  
（7）红⿊树，红⾊和⿊⾊两种节点，有⼀⼤堆的条件限制，尽可能保证树是平衡的，不会出现瘸腿的情况  
（8）如果插⼊节点的时候破坏了红⿊树的规则和平衡，会⾃动重新平衡，变⾊（红 <-> ⿊），旋转，左  
旋转，右旋转  
问题：volatile关键字底层原理，volatile关键字是否可以禁⽌指令重排以及如何底层如何实现的指令重排  
（1）这⾥贴下⽯杉⽼师在讲volatile关键字底层原理画的图：硬件级别的原理:  
[http://note.youdao.com/s/Mr2SnBoK](http://note.youdao.com/s/Mr2SnBoK)  
下⾯是我根据⽼师的思路学习的笔记  
（2）主动从内存模型开始讲起，原⼦性、可⻅性、有序性的理解，volatile关键字的原理  
java内存模型：[http://note.youdao.com/s/MKm6vAP8](http://note.youdao.com/s/MKm6vAP8)  
（3）可⻅性：⼀个线程修改了变量，其他线程能⻢上读取到该变量的最新值  
read（从主存读取），load（将主存读取到的值写⼊⼯作内存），use（从⼯作内存读取数据来计  
算），assign（将计算好的值重新赋值到⼯作内存中），  
store（将⼯作内存数据写⼊主存），write（将store过去的变量值赋值给主存中的变量）  
这个是流程图：[http://note.youdao.com/s/XazdAWWu](http://note.youdao.com/s/XazdAWWu)

3  
（4）volatile读的内存语义如下：当读⼀个volatile变量时，JMM会把该线程对应的本地内存置为⽆效。  
线程接下来将从主内存中读取共享变量。  
这个是流程图：[http://note.youdao.com/s/GBzGnrOH](http://note.youdao.com/s/GBzGnrOH)  
（4-1）当读flag变量后，本地内存B包含的值已经被置为⽆效。此时，线程B必须从主内存中读取共享变  
量，线程B的读取操作将导致本地内存B与主内存  
中的共享变量的值变成⼀致。  
（4-2）volatile写和volatile读的内存语义总结：  
线程A写⼀个volatile变量，实质上是线程A向接下来将要读这个volatile变量的某个线程发出了（其对共享  
变量所做修改的）消息。  
线程B读⼀个volatile变量，实质上是线程B接收了之前某个线程发出的（在写这个volatile变量之前对共享  
变量所做修改的）消息。  
线程A写⼀个volatile变量，随后线程B读这个volatile变量，这个过程实质上是线程A通过主内存向线程B  
发送消息。  
（5）锁的释放和获取的内存语义：当线程释放锁时，JMM会把该线程对应的本地内存中的共享变量刷新  
到主内存中。  
当线程获取锁时，JMM会把该线程对应的本地内存置为⽆效。从⽽使得被监视器保护的临界区代码必须  
从主内存中读取变量。  
（6）有序性：基于happens-before原则来看volatile关键字如何保证有序性  
这个是流程图：[http://note.youdao.com/s/BPU2J7te](http://note.youdao.com/s/BPU2J7te)  
happens-before规则  
（6-1）程序顺序规则：⼀个线程中的每个操作，happens-before于该线程中的任意后续操作。  
（6-2）监视器锁规则：对⼀个锁的解锁，happens-before于随后对这个锁的加锁。  
（6-3）volatile变量规则：对⼀个volatile变量域的写，happens-before于任意后续对这个volatile域的  
读  
（6-4）传递性：如果A happens-before B，且B happens-before C，那么A happens-before C。  
（6-5）start()规则：如果线程A执⾏操作ThreadB.start()（启动线程B），那么A线程的  
ThreadB.start()操作happens-before于线程B中的任意操作。  
（6-6）join()规则：如果线程A执⾏操作ThreadB.join()并成功返回，那么线程B中的任意操作happensbefore与线程A从ThreadB.join()操作成功返回。

4  
（7） 原⼦性：volatile关键字不能保证原⼦性，唯⼀的场景就是在32位虚拟机，对long/double变量的赋  
值写是原⼦的，volatile关键字底层原理，lock指令以及内存屏，  
（8）lock指令：volatile实现的两条原则  
（8-1）Lock前缀指令会引起处理器缓存回写到内存。  
（8-2）⼀个处理器的缓存回写到内存会导致其他处理器的缓存失效。  
（8-3）缓存⼀致性协议：[http://note.youdao.com/s/NDbe0gMB](http://note.youdao.com/s/NDbe0gMB)  
问题：线程有⼏种状态，状态之间的变化是怎样的？  
Java线程在运⾏的声明周期中可能处于6种不同的状态，在给定的⼀个时刻，线程只能处于其中的⼀个状  
态 这  
⾥我弄了⼏张图：  
[http://note.youdao.com/s/ODYruIR9](http://note.youdao.com/s/ODYruIR9)  
[http://note.youdao.com/s/cm4ARggj](http://note.youdao.com/s/cm4ARggj)

问题：简述线程池的原理，⾃定义线程池的参数以及每个参数的意思，线程池有哪⼏种，分别的应⽤场景  
举例  
⼤家先看下这个构造图：[http://note.youdao.com/s/AO4EncTZ](http://note.youdao.com/s/AO4EncTZ)  
corePoolSize：线程池⾥应该有多少个线程  
maximumPoolSize：如果线程池⾥的线程不够⽤了，等待队列还塞满了，此时有可能根据不同的线程池的  
类型，可能会增加⼀些线程出来，但是最多把线程数量增加到maximumPoolSize指定的数量  
keepAliveTime + TimeUnit：如果你的线程数量超出了corePoolSize的话，超出corePoolSize指定数量  
的线程，就会在空闲keepAliveTime毫秒之后，就会⾃动被释放掉  
workQueue：你的线程池的等待队列是什么队列

5  
threadFactory：在线程池⾥创建线程的时候，你可以⾃⼰指定⼀个线程⼯⼚，按照⾃⼰的⽅式创建线程出  
来 RejectedExecutionHandler：如果线程池⾥的线程都在执⾏任务，然后等待队列满了，此时增加额外线  
程也达到了maximumPoolSize指定的数量了，这个时候实在⽆法承载更多的任务了，此时就会执⾏这个东  
⻄（拒绝策略）  
上⾯的基本参数的意义以外。我还推荐⼤家看下 美团技术团队写的《Java线程池实现原理及其在美团业  
务中的实践》  
[https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html](https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html) 这篇⽂章，写的  
⾮常⼲。  
问题：简述OSI七层⽹络模型，TCP/IP四层⽹络模型  
OSI七层⽹络模型，⽹络的七层加⼯从下到上主要包括物理层，数据链路层，⽹络层，传输层，会话层，  
表示层，应⽤层  
这个是OSI七层⽹络模型：[http://note.youdao.com/s/AstSGIs7](http://note.youdao.com/s/AstSGIs7)

问题：简述TCP三次握⼿以及四次挥⼿  
TCP三次握⼿的过程如下：  
（1）客户端发送SYN(seq=x)报⽂给服务器端，进⼊SYN_SEND状态。  
（2）服务器端收到SYN报⽂，回应⼀个SYN(seq=y)和ACK(ack = x+1)报⽂，进⼊SYN_RECV状态。  
（3）客户端收到服务器端的SYN报⽂，回应⼀个ACK(ack=y+1)报⽂，进⼊Established状态。  
TCP三次握⼿的过程图：[http://note.youdao.com/s/biib0eAF](http://note.youdao.com/s/biib0eAF)

TCP四次挥⼿的过程如下：[http://note.youdao.com/s/HCXT8KMR](http://note.youdao.com/s/HCXT8KMR)  
学习资料：⽯杉⽼师在架构班讲的：《讲给Java⼯程师听的⼤⽩话⽹络课程》  
推荐书籍： 《⽹络是怎样连接的》《图解TCP/IP》 《图解⽹络硬件》 《图解HTTP》

问题：CMS垃圾回收的过程  
这个是JVM内存划分的图：[http://note.youdao.com/s/9MR4PLq7](http://note.youdao.com/s/9MR4PLq7)  
这⾥援引下儒猿群群友根据《从 0 开始带你成为JVM实战⾼⼿》专栏 总结出来的图，分享给⼤家，  
[https://www.processon.com/view/link/5e69db12e4b055496ae4a673](https://www.processon.com/view/link/5e69db12e4b055496ae4a673)

CMS的⼯作机制相对复杂，垃圾回收过程包含如下4个步骤  
（1）初始标记：只标记和GC Roots直接关联的对象，速度很快，需要暂停所有⼯作线程。  
（2）并发标记：和⽤户线程⼀起⼯作，执⾏GC Roots跟踪标记过程，不需要暂停⼯作线程。  
（3）重新标记：在并发标记过程中⽤户线程继续运⾏，导致在垃圾回收过程中部分对象的状态发⽣变化，  
为了确保这部分对象的状态正确性，需要对其重新标记并暂停⼯作线程。  
（4）并发清除：和⽤户线程⼀起⼯作，执⾏清除GC Roots不可达对象的任务，不需要暂停⼯作线程。  
问题：G1与CMS的区别，你们公司使⽤的是哪个，为什么？（这个需要结合⾃⼰的业务场景回答）  
相对于CMS垃圾收集器，G1垃圾收集器两个突出的改进。  
（1）基于标记整理算法，不产⽣内存碎⽚。  
（2）可以精确地控制停顿时间，在不牺牲吞吐量的前提下实现短停顿垃圾回收。

问题：JVM参数举例，讲讲为什么这么设置，为了避免fullGC的停顿对系统的影响，有哪些解决⽅案？  
由于⽂本不⽅便贴代码，贴在在了有道云笔记⾥⾯：[http://note.youdao.com/s/X4Qmucr0](http://note.youdao.com/s/X4Qmucr0)  
为解决应⽤在午⾼峰发⽣ full gc ⽽影响系统响应时间问题, 考虑低峰期主动进⾏ full gc 对 old 区进⾏释  
放.  
确保启动参数中 -XX:+DisableExplicitGC 项被删除, 该参数作⽤是禁⽌ System.gc() 调⽤. (启动参数⼀  
般配在 start 脚本中)  
在启动参数中加⼊ -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses, 该参数的作⽤是主动  
System.gc() 时调⽤ CMS 算法进⾏ gc 操作.  
问题：内存模型以及分区，需要详细到每个区放什么

JVM 分为堆区和栈区，还有⽅法区，初始化的对象放在堆⾥⾯，引⽤放在栈⾥⾯， class 类信息常量池  
(static 常量和 static 变量)等放在⽅法区  
（1） ⽅法区:主要是存储类信息，常量池(static 常量和 static 变量)，编译后的代码(字 节码)等数据  
（2） 堆:初始化的对象，成员变量 (那种⾮ static 的变量)，所有的对象实例和数组都要 在堆上分配  
（3） 栈:栈的结构是栈帧组成的，调⽤⼀个⽅法就压⼊⼀帧，帧上⾯存储局部变量表，操 作数栈，⽅法出  
⼝等信息，局部变量表存放的是 8 ⼤基础类型加上⼀个应⽤类型，所 以还是⼀个指向地址的指针  
（4） 本地⽅法栈:主要为 Native ⽅法服务  
（5） 程序计数器:记录当前线程执⾏的⾏号

问题：JVM内存分那⼏个区，每个区的作⽤是什么？  
java 虚拟机主要分为以下⼀个区:  
⽅法区:  
1. 有时候也成为永久代，在该区内很少发⽣垃圾回收，但是并不代表不发⽣ GC，在这⾥ 进⾏的 GC 主  
要是对⽅法区⾥的常量池和对类型的卸载  
2. ⽅法区主要⽤来存储已被虚拟机加载的类的信息、常量、静态变量和即时编译器编译后 的代码等数据。  
3. 该区域是被线程共享的。  
4. ⽅法区⾥有⼀个运⾏时常量池，⽤于存放静态编译产⽣的字⾯量和符号引⽤。该常量池 具有动态性，  
也就是说常量并不⼀定是编译时确定，运⾏时⽣成的常量也会存在这个常量 池中。  
虚拟机栈:  
1. 虚拟机栈也就是我们平常所称的栈内存,它为 java ⽅法服务，每个⽅法在执⾏的时候都  
会创建⼀个栈帧，⽤于存储局部变量表、操作数栈、动态链接和⽅法出⼝等信息。  
2. 虚拟机栈是线程私有的，它的⽣命周期与线程相同。  
3. 局部变量表⾥存储的是基本数据类型、returnAddress 类型(指向⼀条字节码指令的地 址)和对象引⽤，  
这个对象引⽤有可能是指向对象起始地址的⼀个指针，也有可能是代表 对象的句柄或者与对象相关联的位

8  
置。局部变量所需的内存空间在编译器间确定

4.操作数栈的作⽤主要⽤来存储运算结果以及运算的操作数，它不同于局部变量表通过索 引来访问，⽽是  
压栈和出栈的⽅式 5.每个栈帧都包含⼀个指向运⾏时常量池中该栈帧所属⽅法的引⽤，持有这个引⽤是为  
了 ⽀持⽅法调⽤过程中的动态连接.动态链接就是将常量池中的符号引⽤在运⾏期转化为直接 引⽤。  
本地⽅法栈和虚拟机栈类似，只不过本地⽅法栈为 Native ⽅法服务。  
堆：  
java 堆是所有线程所共享的⼀块内存，在虚拟机启动时创建，⼏乎所有的对象实例都在这 ⾥创建，因此该  
区域经常发⽣垃圾回收操作。  
程序计数器 内存空间⼩，字节码解释器⼯作时通过改变这个计数值可以选取下⼀条需要执⾏的字节码 指  
令，分⽀、循环、跳转、异常处理和线程恢复等功能都需要依赖这个计数器完成。该内 存区域是唯⼀⼀个  
java 虚拟机规范没有规定任何 OOM 情况的区域。  
问题：堆⾥⾯的分区：Eden，survival (from+ to)，⽼年代，各⾃的特点。  
堆⾥⾯分为新⽣代和⽼⽣代(java8 取消了永久代，采⽤了 Metaspace)，新⽣代包 含 Eden+Survivor  
区，  
survivor 区⾥⾯分为 from 和 to 区，内存回收时，如果⽤的是复 制算法，  
从 from 复制到 to，当经过⼀次或者多次 GC 之后，存活下来的对象会被移动 到⽼年区，当 JVM 内存不  
够⽤的时候，  
会触发 Full GC，清理 JVM ⽼年区 当新⽣区满了之后会触发 YGC,先把存活的对象放到其中⼀个  
Survice 区，然后进⾏垃圾清理。  
因为如果仅仅清理需要删除的对象，这样会导致内存碎 ⽚，因此⼀般会把 Eden 进⾏完全的清理，然后整  
理内存。那么下次 GC 的时候，  
就会使⽤下⼀个 Survive，这样循环使⽤。如果有特别⼤的对象，新⽣代放不下， 就会使⽤⽼年代的担  
保，直接放到⽼年代⾥⾯。因为 JVM 认为，⼀般⼤对象的存 活时间⼀般⽐较久远。

问题：如何判断⼀个对象是否存活？（或者GC对象的判定⽅法）  
判断⼀个对象是否存活有两种⽅法:  
1. 引⽤计数法 所谓引⽤计数法就是给每⼀个对象设置⼀个引⽤计数器，每当有⼀个地⽅引⽤这个对象  
时，  
就将计数器加⼀，引⽤失效时，计数器就减⼀。当⼀个对象的引⽤计数器为零时，说 明此对象没有被引  
⽤，  
也就是“死对象”,将会被垃圾回收. 引⽤计数法有⼀个缺陷就是⽆法解决循环引⽤问题，  
也就是说当对象 A 引⽤对象 B，对象 B ⼜引⽤者对象 A，那么此时 A,B  
对象的引⽤计数器都不为零，也就造成⽆法完成垃圾回 收，所以主流的虚拟机都没有采⽤这种算法。  
2.可达性算法(引⽤链法)  
该算法的思想是:从⼀个被称为 GC Roots 的对象开始向下搜索，如果⼀个对象到 GC Roots 没有任何引  
⽤链相连时，则说明此对象不可⽤。  
在 java 中可以作为 GC Roots 的对象有以下⼏种: • 虚拟机栈中引⽤的对象  
⽅法区类静态属性引⽤的对象 • ⽅法区常量池引⽤的对象  
本地⽅法栈 JNI 引⽤的对象 虽然这些算法可以判定⼀个对象是否能被回收，但是当满⾜上述条件时，⼀个  
对象⽐不⼀ 定会被回收。当⼀个对象不可达 GC Root 时，这个对象并 不会⽴⻢被回收，⽽是出于⼀个死  
缓的阶段，若要被真正的回收需要经历两次标记 如果对象在可达性分析中没有与 GC Root 的引⽤链，那  
么此时就会被第⼀次标记并且进⾏ ⼀次筛选，筛选的条件是是否有必要执⾏ finalize()⽅法。当对象没有  
覆盖 finalize()⽅法  
或者已被虚拟机调⽤过，那么就认为是没必要的。  
如果该对象有必要执⾏ finalize()⽅法，那么这个对象将会放在⼀个称为 F-Queue 的对队 列中，虚拟机  
会触发⼀个 Finalize()线程去执⾏，此线程是低优先级的，并且虚拟机不会承 诺⼀直等待它运⾏完，这是  
因为如果 finalize()执⾏缓慢或者发⽣了死锁，那么就会造成 F- Queue 队列⼀直等待，造成了内存回收  
系统的崩溃。GC 对处于 F-Queue 中的对象进⾏ 第⼆次被标记，这时，该对象将被移除”即将回收”集  
合，等待回收。

10  
问题：服务类加载过多引发的OOM问题如何排查  
如果服务出现⽆法调⽤接⼝假死的情况，⾸先要考虑的是两种问题  
（1）第⼀种问题，这个服务可能使⽤了⼤量的内存，内存始终⽆法释放，因此导致了频繁GC问题。  
也许每秒都执⾏⼀次Full GC，结果每次都回收不了多少，最终导致系统因为频繁GC，频繁Stop the  
World，接⼝调⽤出现频繁假死的问题  
（2）第⼆种问题，可能是这台机器的CPU负载太⾼了，也许是某个进程耗尽了CPU资源，导致你这个服  
务的线程始终⽆法得到CPU资源去执⾏，  
也就⽆法响应接⼝调⽤的请求。这也是⼀种情况。  
在内存使⽤这么⾼的情况下会发⽣什么？  
第⼀种，是内存使⽤率居⾼不下，导致频繁的进⾏Full GC，gc带来的stop the world问题影响了服务。  
第⼆种，是内存使⽤率过多，导致JVM⾃⼰发⽣OOM。  
第三种，是内存使⽤率过⾼，也许有的时候会导致这个进程因为申请内存不⾜，直接被操作系统把这个进  
程给杀掉了

问题：如何在JVM内存溢出的时候⾃动dump内存快照？  
-XX:+HeapDumpOnOutOfMemoryError  
-XX:HeapDumpPath=/usr/local/app/oom  
第⼀个参数意思是在OOM的时候，⾃动dump内存快照出来，第⼆个参数是说把内存快照放到哪去  
⾃⼰阅读的书籍举例：《实战Java虚拟机：JVM故障诊断与性能优化（第2版）》  
Netty知识点对应的⽼师的课程：《Netty核⼼功能精讲以及核⼼源码剖析》  
问题：NIO开发的话为什么选择netty  
不选择Java原⽣NIO编程的原因  
（1）NIO的类库和API的繁杂，使⽤麻烦，你需要熟练掌握Selector、ServerSocketChannel、  
SocketChannel、ByteBuffer等。  
（2）需要具备其他的额外技能做铺垫，例如熟悉Java多线程编程。这是因为NIO编程涉及到Reactor模  
式，你必须对多线程和⽹络编程⾮常熟悉，才能写出⾼质量的NIO程序。

11  
（3）可靠性能⼒补⻬，⼯作量和难度都⾮常⼤。例如客户端⾯临重连、⽹络闪断、半包读写、失败缓存、  
⽹络拥塞和异常码流的处理的问题，NIO编程的特点就是功能开发相对  
容易，但是可靠性能⼒补⻬⼯作量和难度都⾮常⼤  
（4）JDK NIO的BUG，例如臭名昭著的epoll bug，它会导致Selector空轮询，最终导致CPU 100%  
为什么选择Netty  
（1）API使⽤简单，开发⻔槛低；  
（2）功能强⼤，预置了多种编解码弄能，⽀持多种主流协议；  
（3）定制能⼒强，可以通过ChannelHandler对通信框架进⾏灵活地扩展；  
（4）性能⾼，通过与其他业界主流的NIO框架对⽐，Netty的综合性能最优；  
（5）成熟、稳定，Netty修复了已经发现的所有JDK NIO BUG，业务开发⼈员不需要再为NIO的BUG⽽  
烦恼；  
（6）社区活跃，版本迭代周期短，发现的BUG可以被及时修复，同时，更多的新功能会加⼊；  
（7）经历了⼤规模的商业应⽤考验，质量得到验证。  
问题：简述TCP粘包拆包以及解决⽅案  
开局⼀个图：[http://note.youdao.com/s/2KZBtMrc](http://note.youdao.com/s/2KZBtMrc)  
假设客户端分别发送了两个数据包D1和D2给服务端，由于服务端⼀次读取到的字节数是不确定的，故可能  
存在以下4种情况  
（1）服务端分两次读取到了两个独⽴的数据包，分别是D1和D2，没有粘包和拆包；  
（2）服务端⼀次接收到了两个数据包，D1和D2粘合在⼀起，被称为TCP粘包；  
（3）服务端分两次读取到了两个数据包，第⼀次读取到了完整的D1包和D2包的部分内容，第⼆次读取到  
了D2包的剩余内容，这被称为TCP拆包；  
（4）服务端分两次读取到了两个数据包，第⼀次读取到了D1包的部分内容D1_1，第⼆次读取到了D1包的  
剩余内容D1_2和D2包的整包。

12  
TCP粘包/拆包发⽣的原因  
（1）应⽤程序write写⼊的字节⼤⼩⼤于套接⼝发送缓冲区⼤⼩；  
（2）进⾏MSS（Maxitum Segment Size 最⼤分段⼤⼩）⼤⼩的TCP分段；  
（3）以太⽹帧的payload⼤于MTU（Maxitum Transmission Unit 最⼤传输单元）进⾏IP分⽚。  
粘包问题的解决策略  
（1）消息定⻓，例如每个报⽂的⼤⼩为固定⻓度200字节，如果不够，空位补空格；  
（2）在包尾增加回⻋换换符进⾏分割，例如FTP协议；  
（3）将消息分为消息头和消息体，消息头中包含表示消息总⻓度（或者消息体⻓度）的字段，通常设计思  
想为消息头的⼀个字段使⽤int32来表示消息的总⻓度；  
（4）更复杂的应⽤层协议。  
问题：简述netty服务端和客户端创建的流程  
看下这个图：[http://note.youdao.com/s/CqMn1VPv](http://note.youdao.com/s/CqMn1VPv) 在⾯试的时候回答这个图⾥⾯的流程  
问题：简述Netty的线程模型（这个最好画图，显示出⾃⼰思路清新）  
现场画图：[http://note.youdao.com/s/5SlaXNPB](http://note.youdao.com/s/5SlaXNPB)  
问题：Netty解决了java原⽣NIO哪些问题（空轮询的bug，这个⼀定要说出来）  
⼤家看下这个博客写的挺好的：[https://blog.csdn.net/baiye_xing/article/details/73351330](https://blog.csdn.net/baiye_xing/article/details/73351330)  
问题：多路复⽤、零拷⻉等原理  
1. 传统数据传送  
传统数据从Socket⽹络中传送，需要4次数据拷⻉和4次上下⽂切换：  
• 将磁盘⽂件，读取到操作系统内核缓冲区；  
• 将内核缓冲区的数据，拷⻉到⽤户空间的缓冲区；

数据从⽤户空间缓冲区拷⻉到内核的socket⽹络发送缓冲区；  
• 数据从内核的socket⽹络发送缓冲区拷⻉到⽹卡接⼝（硬件）的缓冲区，由⽹卡进⾏⽹络传输。  
这个是流程图：[http://note.youdao.com/s/6wXq7f13](http://note.youdao.com/s/6wXq7f13)  
传统⽅式，读取磁盘⽂件并进⾏⽹络发送，经过的4次数据拷⻉和4次上下⽂切换是⾮常繁琐的。实际IO读  
写，需要进⾏IO中断，  
需要CPU响应中断(带来上下⽂切换)，尽管后来引⼊DMA来接管CPU的中断请求，但四次拷⻉仍在存在不  
必要的环节。  
[http://note.youdao.com/s/QMdngSkf](http://note.youdao.com/s/QMdngSkf)  
2. 零拷⻉实现原理  
零拷⻉的⽬的是为了减少IO流程中不必要的拷⻉，以及减少⽤户进程地址空间和内核地址空间之间因为上  
下⽂切换⽽带来的开销。  
由于虚拟机不能直接操作内核，因此它的实现需要操作系统OS的⽀持，也就是需要kernel内核暴漏API。  
2.1 Netty中的零拷⻉  
1. Direct Buffers：Netty的接收和发送ByteBuffer采⽤直接缓冲区（Direct Buffer）实现零拷⻉，直  
接在内存区域分配空间，避免了读写数据的⼆次内存拷⻉，这就实现了读写Socket的零拷⻉。  
如果使⽤传统的堆内存缓冲区（Heap Buffer）进⾏Socket读写，JVM会将堆内存Buffer拷⻉到直接内存  
中，然后才写⼊Socket中。相⽐堆外直接内存，消息在发送过程中多了⼀次缓冲区的内存拷⻉。  
2. CompositeByteBuf：它可以将多个ByteBuf封装成ByteBuf，对外提供统⼀封装后的ByteBuf接⼝。  
CompositeByteBuf并没有真正将多个Buffer组合起来，⽽是保存了它们的引⽤，从⽽避免了数据的拷  
⻉，实现了零拷⻉。  
传统的ByteBuffer，如果需要将两个ByteBuffer中的数据组合到⼀起，我们需要⾸先创建⼀个  
size=size1+size2⼤⼩的新的数组，然后将两个数组中的数据拷⻉到新的数组中。但是使⽤Netty提供的组  
合ByteBuf，就可以避免这样的操作。

14  
3. Netty的⽂件传输类DefaultFileRegion通过调⽤FileChannel.transferTo()⽅法实现零拷⻉，⽂件缓冲  
区的数据会直接发送给⽬标Channel。底层调⽤Linux操作系统中的sendfile()实现的，数据从⽂件由DMA  
引擎拷⻉到内核read缓冲区，；DMA从内核read缓冲区将数据拷⻉到⽹卡接⼝（硬件）的缓冲区，由⽹卡  
进⾏⽹络传输。  
问题：简述netty整体架构  
来⼀张⽼师在讲netty的时候整体架构图：[http://note.youdao.com/s/Zq4OixMr](http://note.youdao.com/s/Zq4OixMr) 把⽼师这张图熟记于  
⼼，这个流程最好能在⾯试中画出来。  
⾃⼰阅读的书籍举例：《Netty权威指南（第2版）》  
Redis知识点对应的⽼师的课程：亿级流量电商详情⻚系统实战  
⾯试官提问的部分问题：  
问题：分别介绍下redis的内存模型和线程模型  
[https://gitee.com/shishan100/Java-Interview-Advanced/blob/master/docs/highconcurrency/redis-single-thread-model.md](https://gitee.com/shishan100/Java-Interview-Advanced/blob/master/docs/highconcurrency/redis-single-thread-model.md) ⽼师的⾯试训练营  
问题：缓存雪崩以及穿透的解决⽅案？  
缓存雪崩发⽣的现象  
缓存雪崩的事前事中事后的解决⽅案  
事前：redis⾼可⽤，主从+哨兵，redis cluster，避免全盘崩溃  
事中：本地ehcache缓存 + hystrix限流&降级，避免MySQL被打死  
事后：redis持久化，快速恢复缓存数据  
缓存雪崩现象图：[http://note.youdao.com/s/XMyKXr25](http://note.youdao.com/s/XMyKXr25)  
如何解决缓存⾎崩 ：[http://note.youdao.com/s/53UbmTKV](http://note.youdao.com/s/53UbmTKV)

15  
缓存穿透现象以及解决⽅案： [http://note.youdao.com/s/1oONTfsh](http://note.youdao.com/s/1oONTfsh)  
简述redis分布式锁的原理  
[https://gitee.com/shishan100/Java-Interview-Advanced/blob/master/docs/distributedsystem/distributed-lock-redis-vs-zookeeper.md](https://gitee.com/shishan100/Java-Interview-Advanced/blob/master/docs/distributedsystem/distributed-lock-redis-vs-zookeeper.md) ⽼师的⾯试训练营  
⾃⼰阅读的书籍举例：《Redis设计与实现》  
ZooKeeper  
知识点对应的⽼师的课程：《08_ZooKeeper顶尖⾼⼿课程：从实战到源码》  
问题：2PC与3PC是什么，两者的流程，以及优缺点  
2PC， 即⼆阶段提交， 为了是基于分布式系统架构下的所有节点在进⾏事务处理过程中能够保持原⼦性和  
⼀致性⽽设计的⼀种算法。  
通常，⼆阶段提交协议也被认为是⼀种⼀致性协议，⽤来保证分布式系统数据的⼀致性。⽬前绝⼤部分的  
关系型数据库都是采⽤⼆阶段提交协议，来完成分布式处理的，利⽤该协议能够⾮常⽅便地完成  
所有分布式事务参与者的协调，统⼀决定事务的提交或回滚，从⽽能够有效地保证分布式数据⼀致性，因  
此⼆阶段提交协议被⼴泛地应⽤在许多分布式系统中。  
阶段⼀：提交事务请求  
（1）事务询问  
（2）执⾏事务。  
（3）各参与者向协调者反馈事务询问的响应。  
阶段⼆：执⾏事务提交  
（1）发送提交请求  
（2）事务提交  
（3）反馈事务提交结果  
（4）完成事务

16  
中断事务  
（1）发送回滚请求  
（2）事务回滚  
（3）反馈事务回滚结果  
⼆阶段提交协议的优点：原理简单，实现⽅便  
⼆阶段提交协议的缺点：同步阻塞，单点问题，脑裂，太过保守  
这个是流程图：[http://note.youdao.com/s/aUlgviGc](http://note.youdao.com/s/aUlgviGc)

3PC，即三阶段提交，是2PC的改进版，其将⼆阶段提交协议的提交事务请求过程⼀分为⼆，形成了由  
CanCommit、PreCommit和doCommit三个阶段组成的事务处理协议  
阶段⼀：CanCommit  
1、事务询问  
2、各参与者向协调者反馈事务询问的响应。  
阶段⼆：PreCommit  
执⾏事务预提交  
1、发送预提交请求  
2、事务预提交  
3、各参与者向协调者反馈事务执⾏的响应。  
中断事务  
1、发送中断请求。  
2、中断事务  
阶段三：doCommit  
1、发送提交请求  
2、事务提交  
3、反馈事务提交结果  
4、完成事务  
中断事务  
1、发送中断请求  
2、事务回滚  
3、反馈事务回滚结果  
4、中断事务

17  
三阶段提交协议的优点：相较于⼆阶段提交协议，三阶段提交协议最⼤的优点就是降低了参与者的阻塞范  
围，并能够在出现单点故障后继续达成⼀致。  
三阶段提交协议的缺点：三阶段提交协议在去除阻塞的同时也引⼊了新的问题，那就是在参与者接收到  
PreCommit消息后，如果⽹络出现分区，此时协调者所在的节点和参与者  
⽆法进⾏正常的⽹络通信，在这种情况下，该参与者依然会进⾏事务提交，这必然出现数据的不⼀致。  
这个是流程图：[http://note.youdao.com/s/JllRPDgf](http://note.youdao.com/s/JllRPDgf)  
问题：简述ZAB协议  
类似于⼀个两阶段提交。  
（1）群⾸向所有追随者发送⼀个PROPOSAL消息p。  
（2）当⼀个追随者接收到消息p后，会响应群⾸⼀个ACK消息，通知群⾸其已接受提案（proposal）  
（3）当收到仲裁数量的服务器发送的确认消息后（该仲裁数包括群⾸⾃⼰），群⾸就会发送消息通知追随  
者进⾏提交（COMMIT）操作。  
问题：强⼀致性和最终⼀致性的区别，ZooKeeper的⼀致性是怎样的？  
强⼀致性：只要写⼊⼀条数据，⽴⻢⽆论从zk哪台机器上都可以⽴⻢读到这条数据，强⼀致性，你的写⼊  
操作卡住，直到leader和全部follower都进⾏了commit之后，才能让写⼊操作返回，认为写⼊成功了  
此时只要写⼊成功，⽆论你从哪个zk机器查询，都是能查到的，强⼀致性  
ZAB协议机制，zk⼀定不是强⼀致性  
最终⼀致性：写⼊⼀条数据，⽅法返回，告诉你写⼊成功了，此时有可能你⽴⻢去其他zk机器上查是查不  
到的，短暂时间是不⼀致的，但是过⼀会⼉，最终⼀定会让其他机器同步这条数据，最终⼀定是可以查到  
的 研  
究了ZooKeeper的ZAB协议之后，你会发现，其实过半follower对事务proposal返回ack，就会发送  
commit给所有follower了，只要follower或者leader进⾏了commit，这个数据就会被客户端读取到了

18  
那么有没有可能，此时有的follower已经commit了，但是有的follower还没有commit？绝对会的，所以  
有可能其实某个客户端连接到follower01，可以读取到刚commit的数据，但是有的客户端连接到  
follower02在这个时间还没法读取到  
所以zk不是强⼀致的，不是说leader必须保证⼀条数据被全部follower都commit了才会让你读取到数据，  
⽽是过程中可能你会在不同的follower上读取到不⼀致的数据，但是最终⼀定会全部commit后⼀致，让你  
读到⼀致的数据的  
zk官⽅给⾃⼰的定义：顺序⼀致性  
因此zk是最终⼀致性的，但是其实他⽐最终⼀致性更好⼀点，出去要说是顺序⼀致性的，因为leader⼀定  
会保证所有的proposal同步到follower上都是按照顺序来⾛的，起码顺序不会乱  
但是全部follower的数据⼀致确实是最终才能实现⼀致的  
如果要求强⼀致性，可以⼿动调⽤zk的sync()操作  
问题：⽺群效应是什么，如何解决的？  
zk在共享锁的获取和释放流程图：[http://note.youdao.com/s/aKrNn9K9](http://note.youdao.com/s/aKrNn9K9)  
在整个分布式锁的竞争过程中，⼤量的“Watcher通知”和“⼦节点列表获取”两个操作重复运⾏，  
并且绝⼤多数的运⾏结果都是判断出⾃⼰并⾮是序号最⼩的节点，从⽽继续等待下⼀次通知，  
这看起来显然不怎么科学。客户端⽆端地接收到过多和⾃⼰不相关的事件通知，如果在集群规模⽐较⼤的  
情况下，不仅会对ZooKeeper服务器造成巨⼤的性能影响和⽹络冲击，  
更为严重的是，如果同⼀时间有多个节点对应的客户端完成事务或是事务中断引起节点消失，ZooKeeper  
服务器就会在短时间内向其余客户端发送⼤量的事件通知，这就是⽺群效应。  
这个ZooKeeper分布式锁实现中出现⽺群效应的根源在于，没有找准客户端真正的关注点。我们再来回顾  
⼀下上⾯分布式锁的竞争过程。

19  
它的核⼼逻辑在于：判断⾃⼰是否是所有⼦节点中序号最⼩的。于是很容易可以联想到，每个节点对应的  
客户端只需要关注⽐⾃⼰序号⼩的那个相关节点的变更情况就可以了，⽽不需要关注全局的⼦列表变更情  
况。  
改进过的zk在共享锁的获取和释放流程图：[http://note.youdao.com/s/YofrjZGB](http://note.youdao.com/s/YofrjZGB)  
⼩结：  
我本次⾯试阿⾥，⾯试总共经历了6轮，前3轮技术⾯试都做了算法题，第四轮技术最终⾯试没有做算法  
题，聊项⽬和离职原因等  
HR我⾯了2轮，第⼀轮HR⾯试主要聊⼊职阿⾥要做的产品以及我本⼈的⼀个职业发展规划，第⼆轮HR⾯  
试是HRBP⾯的，主要是谈薪资  
和股票等  
⼀些技术的问题⼤概就是上⾯列举出来的，重点是问我⼯作经历中做的项⽬，以及项⽬中的设计，遇到的  
问题以及解决⽅案，还有就是⾯试官会给出⼀个他们产品中遇到的问题让你通过你过往的⼯作经验给⼀个  
解决⽅案，也就是技术探讨。  
我本次⾯试的重点说的项⽬是⾃研API⽹关，apollo配置中⼼的⼆次开发，运单系统的分库分表⽅案等  
要想进⼊例如阿⾥这样的⼤⼚，必须要⾃⼰有⼀些含⾦量⽐较⾼的项⽬拿出来给⾯试官讲解，并且要讲解  
细节，例如项⽬整体的架构，  
整体流程，项⽬部署的机器配置，平时与活动的QPS峰值，流量估算经验，⾃定义扩展开发或者⾃研的原  
因，踩过哪些坑，以及解决的⽅案是什么  
⽯衫⽼师的互联⽹java⼯程师⾯试突击训练第⼀季、第⼆季、第三季都要看完并且理解  
⼒扣注册⼀个会员，刷题，我是⽤了1年半刷了140道题，题量不要求多，但要有代表性，例如：链表、递  
归、迭代等，然后充分理解解题思路即可，平时没事的时候，对着题能把代码写出来  
再⼀个就是平时的积累和总结了。

3.面试准备

1.基础知识：数据结构+算法、java集合并发、JVM、网络、锁等。

2.常见中间件：缓存Redis、消息队列Mq、网络Netty、数据库Mysql+Es+Hbase等、框架(Dubbo、Spring cloud、Spring等)

3.项目经验：整体架构图、依赖服务关系、团队人数、项目难点、QPS、你负责哪些、哪些最有挑战、你是怎么解决的、你怎么理解你的业务、以后的规划等等

4.个人规划：离职原因、职业规划、你的优点、你的缺点、你的绩效、你和同事关系、你找下一份工作的方向、你为什么应聘我们公司，你是怎么考虑的、你了解我们的业务吗等等

备注：我准备面试主要是架构班课程 + 儒猿技术专栏 + 石杉老师面试突击(一般公司的一面几乎都能覆盖到) + 其他书籍。算法主要是字符串、数组、链表、树、动态规划这些问的比较多，刷LeetCode就行。

简历方面，找老师指导，老师会亲自教你怎么改简历，每个人情况不同，需要定制。

4面试技巧

1.一般基础面试的时候，问的技术栈比较杂，大概就是上面列举的，但是可能大家对于某些有深入了解过，如果问到你擅长的技术栈，你可以多回答一下，如果不是很擅长，就简单的回答一下，每轮面试的时候时间是有限的，尽量把时间都回答在你擅长的技术栈上。

2.面试的时候，如果有的问题可以画图来讲解，一定要画图来讲解，这样比较容易理解，视频面试也可以共享屏幕画图

3.有的面试官是看你简历，擅长哪里，就会有针对性的问你擅长的技术栈，但是有的面试官是不看简历的，只问他自己感兴趣或者他擅长的技术栈。

如果是这样的面试官，最好在自己回答的时候，引导到你擅长的技术栈去。如果问到你不太确定的问题，千万不要随便瞎编回答，你最好先说这个问题我不太了解，然后讲讲自己的想法和思路。

如果你瞎编回答，面试官可能会认为，如果工作中你有不确定的事情，你自己做决定了，会出问题的。

4.大家放好心态，有的面试感觉挺好的，但是就是没过，有的感觉面的不好的，还过了，可能这就是缘分和运气，所以放好心

5.大厂基本都会手写算法，现场面试就是手写，视频面试大部分是牛客网。有的同学对算法有心理恐惧，其实不用太担心，大部分大厂的社招，算法都不会太难，除了类似字节的公司比较难点，可以每天积累一点，把LeetCode上那些热门高频的算法题刷一遍，100道的样子

另外假如你在牛客网写算法的时候，你写完之后，可以不提交（万一报错了呢），直接和面试官说你的思路，除非面试官一定让你提交。

我之前面试的时候，有个面试官让写个布隆过滤器，我没有写出来，面试官说那我给你换一个吧。所以大家面试的时候如果感觉没什么思路，你可以主动和面试官说一下，没有准备好这类算法，可以要求换一个。

6.我个人感觉开放性设计之类的题比较难回答，之前有个公司问设计一个通用的限流器，你怎么设计？我就把我的想法说了一下，然后又有公司问了这个问题，我又把我的想法说了一下，就没有过。后来我也反思了，我感觉可能没有达到面试官想要的点上

如果大家遇见这样的面试题，可以先简单的说说想法，然后和面试官沟通了解，最后能理解到面试官想要的是哪个点。就算你说了很多，我感觉如果没有达到面试官想要的点上，效果应该不是太好。

例如你项目的高可用、高并发、降级等怎么做的？你如果回答说我们系统没有这么高的并发或者没有做降级之类的。面试官几乎立刻就会问，如果要做，你会怎么做？所以说这类问题，大家还是根据自己的项目，自己多反问一下自己。

7.HR面试还是要注意一下的，离职原因、个人规划啥的，尽可能说的圆满一点(其实离职无非就是薪资、加班、不开心之类的，但是HR想听的就是假话，这点大家最好也多注意一下)

5.面试过程

1.技术一面：基础知识+中间件+一点项目，这些问的比较多

2.技术二面：中间件+项目+一点职业规划，你的leader

3.技术三面：中间件+项目+一点个人规划，你的部门leader或者其他部门交叉面试

4.HRBP面试：主要就是个人规划问题

5.HR面试：个人规划+薪资等问题

备注：这里我想强调一点就是二面以后的面试，因为一面问的问题都是一些基础知识，有些东西都是固定的，变化不大。

二面以后我感觉最重要的就是之前说的why、how、what和嗅探机制，大家可以看看我去年面上阿里后写的面经（下面链接），面试的时候眼睛要睁大、放光，表示你很在意这次面试，给面试官留下好的印象，你leader决定你的薪资呦。

[https://sourl.cn/kgAAiN](https://sourl.cn/kgAAiN)

此外，项目里的技术+业务要通透，面试官会变了法的问你。如果有些开放题，感觉难的话，你也要思考，然后说说你的想法，说的不好也要说，哪个面试官喜欢轻言放弃的人呢，对不。

6.面试总结：

我面的公司有点多，加上时间一长，有点忘了，我这里列举一下，我记忆比较深或者频率比较高的面试题。一般都会以连环炮的形式发问，如果你能一直回答，面试官往往会一直深挖下去。

1.java hashMap和redis map的rehash有什么区别？

Java hashMap rehash基于高低位链表,当前节点数组下标元素rehash不变或+旧的容量,存在线程安全问题和fail-fast

redis字典中包含两个哈希表和trehashidx，当标识为-1代表未进行rehash,rehash过程是ht[0]表数据迁移到ht[1],整个hash的过程是渐进式rehash分多次执行完成防止因为某个槽key太多停止服务,在rehash的过程中删除,查找,更新等操作会在两个哈希表执行

2.java的线程池你们是怎么用的？原理是什么？怎么设置参数？有哪些状态？用了线程池有哪些问题？你们怎么解决的？Future是干嘛的？

线程池工作原理，老师架构课画图讲过，下面这张图，边画边跟面试官讲

线程池状态:初始状态-->可运行状态-->运行状态-->休眠状态-->终止状态 ; 线程池问题:无界队列OOM(使用有界队列和备忘录),过饱问题:增加消费者或自定义拒绝策略降低消费者速率 ; future:对runnable或callable的执行结果处理

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617622581356-02120a21-aaa2-4505-9181-adab389d1b85.png)

3.Java 的锁怎么实现的？有哪些？HashMap key可以为null,为什么ConcurrentHashMap key 不可以为null ?非公平锁怎么实现的？AQS每个Node里的节点状态是干嘛用的？

锁的实现基于aqs,常用ReentrantLock ReentrantReadWriteLock ; ConcurrentHashMap不能为null原因,无法去判断到底是key不存在还是value为null; 非公平锁基于cas实现 ;节点状态 CANCELLED:已取消调度 SIGNAL:唤醒后继节点 CONDITION:等待其他线程调用condition.signal()从等待队列到同步队列中获取锁 PROPAGATE:共享模式 前继节点不仅会唤醒后续节点

4.Synchronized  volatile 的作用？原理？怎么用？什么时候用？

synchronized原理图

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617622601535-7dd65b46-f953-4578-a811-37d12504abdc.png)

volatile原理图

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617622608635-fca20cf2-a3e0-4a78-952c-3bbed4da9639.png)

volatile常用场景优雅停机 注册中心服务实例心跳可见等,建议大家看下老师面试突击第三季并发部分内容，对上面这些关键字均有硬件级别的讲解

5.jvm结构？你们jvm的参数是怎么设置的？gc情况怎么样？怎么调优？我们项目的机器差不多每3天一次fullgc,GC已经不能再调优了，这个问题你有啥好的想法吗？

jvm结构:堆 虚拟机栈 本地虚拟机栈 程序计数器 元空间 ;参数设置新生代3G 1:1:8 老年代:1G ,gc情况大概几分钟到几十分钟一次minor gc 每次大概3-5ms左右,几小时一次full gc 每次不超过1s

jvm调优:策略:1.对象预留在新生代 2.大对象直接进入老年代 3.设置合理的对象年龄阀值; 3天full gc一次不能优化,当时没回答好说了一下升级为zgc,zgc推荐看一下美团技术团队分享文章

[https://mp.weixin.qq.com/s/ag5u2EPObx7bZr7hkcrOTg](https://mp.weixin.qq.com/s/ag5u2EPObx7bZr7hkcrOTg)

ps：CMS和G1问的比较多，大家面试准备的时候多看看

6.给你个sql,你说一下怎么创建索引？索引结构？联合索引为什么用要存储主键id，存主键id的内存地址不行吗？索引计划有哪些指标，你关注哪些指标？你了解mysql哪些锁？都是干嘛的？什么操作会有锁？需要注意什么？

根据具体的sql来创建索引,联合索引最左原则(字段不超过5个),索引个数5个以内 ; 索引结构:b+树叶子节点存储数据页 ; 如果存储地址值需要二次寻址 ;执行计划指标:select_type type 可能使用的索引 优化器实际使用索引等,主要关注连接类型type,索引使用情况和extra中内容 ; mysql锁:全局锁 表锁(显示锁和元数据锁MDL) 临界锁(间隙锁+行锁),锁注意事项主要还是死锁学会通过show engine innodb status来分析死锁案例

这里推荐大家看下儒猿技术窝的mysql专栏，里面有很详细的讲解

7.redis你了解哪些？你工作什么场景用？底层数据结构有哪些？分布式锁怎么用？有哪些问题？你们怎么解决的？数据一致性你们怎么做的？分布式事务了解不？你们用过没？你们怎么用的？用了之后有啥问题？你们怎么解决的？redis如何可以动态扩容和缩容？如果你来设计，你怎么设计？

redis 数据结构类型 内存淘汰策略 过期策略 持久化rdb和aof  主从集群(哨兵高可用) 复制和redisCluster这些建议大家看一下《redis设计与实现》 ; 分布式锁:原生set nx ex+lua(get+del)或redisson hash结构支持可重入 或redLock或优化版本加上栅栏验证token ;数据库和缓存一致性推荐大家看一下老师早期出的亿级流量;分布式事务这里就直接引用老师gitee上的文章了

[https://gitee.com/shishan100/Java-Interview-Advanced/blob/master/docs/distributed-system/distributed-transaction.md](https://gitee.com/shishan100/Java-Interview-Advanced/blob/master/docs/distributed-system/distributed-transaction.md)

8.MQ你们用的啥？什么业务场景使用？你是怎么考虑用MQ的？原理你知道多少？MQ有哪些问题需要注意？

这个老师讲的面试题突击第一季的时候讲了mq的连环炮。大家可以看一下。

9.你做过哪些项目？哪些是你主R的项目？对你技术挑战最的项目是哪个？挑战是啥？你是怎么解决的？你项目中哪些做得比较好？还有哪些可以优化？如果你现在负责一个项目，你要怎么推动实施？

这个就要根据个人情况来定，根据自己的项目和经历，把自己做的系统和业务弄透，然后再结合自己的项目多反问一下上面的问题。

10.面试官问，2020年6月18号，晚上18:00点，浏览器输入了jd.com，你把整个过程给我画个图，越详细越好

这个图取决你的薪资，这个是面试官原话

我的理解：这个问题，大家一看可能就是一道网络题，dns啊，加上一些网络包的层层封装，之前面试突击老师也讲过，但是这里有个日期就是6月18号，这个时间有点特殊，可能就会要考虑我们后端的一些东西，比如架构的东西，你就可以说一下，这个首页你要做你怎么做的，是不是用缓存啊，网关怎么走的啊，用什么缓存啊，用不用CDN啊，大家尽可能去发挥自己的架构能力，我就是按照这个思路回答的。

11.要做一个项目，全世界的人聊天app，现在一期只实现发送文字聊天，朋友列表，朋友圈，你给我画一下整个架构图。机器如何部署？

我的理解:聊天大概就是IM，获取朋友圈或者朋友列表，可以用http业务系统的架构来做，这里可能就是IM架构怎么设计，业务系统怎么设计，大概就是画一下这两个系统怎么设计，机器部署的话，因为是全世界，可能需要多机房部署，数据同步之类也要说说。我是按照这个思路回答的。

12.设计一个通用限流器,10、100、1000、10w、1000w的qps可以随意配置，误差率在99%

我的理解：在qps小于一定阈值的时候，可以用全局计数器来作为全局限流，如果qps高于一个阈值，就分配到每个机器上，本地做限流，定期汇报，然后重新分配。我大概就是按照这个思路讲的，限流算法大家也可以学习一下，比如令牌桶、计数器、滑动串口等，也可以参考一下sentinel的设计和架构。

13.设计一个点赞、评论系统，你怎么考虑？

我的理解：如果要求数据实时性比较高的话，可以通过一些flink实时计算来进行统计，如果实时性要求不高，可以本地缓存一下，定期更新，大概就是按照这个思路回答的。

14.现在有一个需求，本来不是你们组负责，但是由于一些其他原因，这个功能要由你们组来负责，你是怎么考虑的？

其实这个问题我感觉不太好回答，当时我是这么回答的，作为一下参考，我说如果这个需求比较急的话，我们可以先做，如果以后有关于这个需求的更新迭代，可以慢慢移植到其他组，自己做业务闭环，好维护。

15.MQ延迟队列你知道多少？你能设计一下吗？你能设计一个支持事务的MQ的功能吗？

这个大家可以参考一下rocketmq的说一下延迟队列是怎么做的。事务的话可以参考一下kafka是怎么设计的。

16.我们组内用一个新的技术组件，但是其他部门没有在使用，如果要推广，你有啥想法？

当时我是这么回答的，作为一下参考，可以把我的新技术组件写个好点的wiki，然后分享一下，看看那个部门需要这个功能，然后一个一个的部门的推。

17.你下一份工作你有什么预期？你对加班的看法？

这个你参考一下你面试的业务和公司，最好说自己的预期和你面试的公司业务和技术匹配度高一些，你面试的是订单组，你说你预期希望做财务系统，这个就不太好了。加班的看法，我感觉最好是说适当加班没有问题，先拿offer再说，拿到offer综合评估加班的情况。

备注:可能大家都能感觉到了，如果问你技术或者项目问题，如果你说不太了解或者说没有做过，那么下面就接着会问，如果是你，你怎么设计怎么解决？大部分都是这个套路，所以大家要多学习基础的原理，项目要搞透。

以上就是我今天的面试分享，最后再次感谢石杉老师，让我两年从一个小型互联网公司跳槽拿到大厂技术专家，同时也感谢儒猿技术窝平台，聚集了一批志同道合爱学习的小伙伴，分享交流技术。大家一起加油，希望每个儒猿群小伙伴都能拿到自己想要的offer

1.jvm垃级回收算法，为什么老年代不能用新生代的复制算法，CMS的cardtable与G1的remeberset的优缺点

2.mysql binlog的用途，binlog的结构，聚集索引与非聚集索引的区别，聚集索引叶子节点的数据结构，mysql主从是推模型还是拉模型，为什么。

3.mysql 组合索引的使用规则

4.redis跳跃表结构，跳跃表中层级的生成规则

5.如何判断二叉树是否是搜索二叉树

6.1亿的数据怎么取前1000条数据

7.项目的订单状态是否用到状态机实现

MQ部分必看：  
1.体验⼀下⾯试官对于消息队列的7个连环炮  
2. MQ的作⽤  
3. MQ保证消息队列的⾼可⽤  
4. MQ保证消息不被重复消费  
5. MQ如何保证消息的顺序性  
6. MQ如何处理消息丢失的问题

7. MQ消息持续积压⼏⼩时怎么处理  
Redis部分必看:  
1. Redis线程模型  
2. Redis数据类型以及⽤的场景  
3. Redis过期策略  
4. Redis持久化RDB/AOF  
5. Redis集群模式架构思想/gossip通信协议/hash slot算法/部署经验  
6. Redis⾼可⽤架构  
7. ⾼并发场景下的缓存⼀致性问题

Redis脑图：

分库分表必看：  
1. 体验⼀下⾯试官对于分库分表这个事⼉的⼀个连环炮  
2. 垂直拆分/⽔平拆分  
3. 动态扩容/不停机迁移  
4. 分库分表后的全局ID⽅案  
熔断技术必看：  
1. 资源隔离/熔断/降级的作⽤  
2. 线程池/信号量两种隔离级别技术理解  
3. 熔断技术的执⾏步骤和流程

Springcloud部分必看：  
1. Springcloud底层架构原理  
2. Springcloud与Dubbo的对⽐  
3. Springcloud的组件  
注册中⼼部分必看：  
1. Eureka注册中⼼基础原理  
2. Zookeeper注册中⼼基础原理  
3. Euerka注册中⼼参数调优  
分布式事务部分必看：  
1. 怎么设计分布式事务技术⽅案  
2. TCC事务、最终⼀致性事务的技术选型  
3. RocketMQ对分布式事务⽀持的底层实现原理

并发编程部分必看：  
1. HashMap底层结构/JDK1.8 HashMap的优化/hash算法/寻址算法  
2. HashMap如何解决hash碰撞/如何扩容  
3. Volatile/synchronized底层原理(原⼦性、可⻅性、顺序性)  
4. CAS底层原理/CAS会引发的问题  
5. AQS底层原理/AQS核⼼的执⾏流程  
6. 线程池的底层⼯作原理

7. 线程池的核⼼配置参数  
8. 8.ConcurrentHashMap底层原理  
⽹络部分必看：  
1. TCP/IP四层⽹络模型  
2. 浏览器请求的全过程是怎么样的  
3. HTTPS的⼯作原理  
Zookeeper部分必看：  
1. ZooKeeper可以做什么？  
2. ZooKeeper集群的三种⻆⾊：Leader、Follower、Observer  
3. ZooKeeper最核⼼的⼀个机制：Watcher监听回调  
4. ZAB的核⼼思想介绍：主从同步机制和崩溃恢复机制  
5. ZooKeeper到底是强⼀致性还是最终⼀致性

JVM专栏课内容，包括下⾯的重点:  
1. 类加载机制/类加载过程  
2. 双亲委派机制/以及他的作⽤  
3. JVM内存区域(堆、栈等其他)  
4. 堆内存划分  
5. 新⽣代、⽼年代垃圾回收机制以及原理  
6. 常⽤的垃圾回收器(ParNew、CMS、G1)  
7. 触发垃圾回收的时机和条件  
8. JVM调优参数模板  
9. JVM分析命令(jstat、jmap、jstack等)  
10. JVM分析⼯具(MAT等)

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617623017727-60e5b3dd-94e4-466a-86ca-ffd912160ba7.png)

Rocketmq专栏课内容，包括下⾯的重点:  
1. Rocketmq架构原理  
2. Rocketmq场景优化  
3. Rocketmq底层原理/消息持久化/raft协议  
4. Rocketmq事务机制  
5. Rocketmq消息0丢失  
6. Rocketmq重复消息/死信队列  
Mysql专栏课内容，包括下⾯的重点:  
1. Mysql架构设计(SQL接⼝、查询解析器、查询优化器、存储引擎、执⾏器)  
2. Mysql⽇志相关(undo log、redo log、binlog)  
3. Innodb存储引擎(buffer pool结构、free链表作⽤、flush链表作⽤、lru链表作⽤)  
4. Mysql数据⻚/数据⾏/表空间/数据区  
5. Mysql事务隔离级别/MVCC机制原理  
6. 索引原理/索引规则/索引优化  
7. Explain执⾏计划分析

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617623066552-c0445a33-346b-4978-975f-6e35a97dc433.png)

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617623093080-1f2bf9e1-08cf-4cfc-9c4b-04931bd9f157.png)

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617623110862-04c9758c-5bf5-4d84-819a-90b6be9ea341.png)

架构课内容：  
⼤型电商系统v1.0项⽬实战⾥⾯的设计模式部分必看：  
复习⼏个⽐较重要的设计模式：  
策略模式/迭代器模式/⼯⼚模式/代理模式/构造器模式/适配器模式  
基于微服务架构的⼤型分布式电商系统部分必看：  
主要复习微服务Spring Cloud那块：  
1. Eureka服务注册与发现的原理/⼼跳检测/注册表抓取/⾃我保护机制  
2. Eureka注册表多级缓存机制/参数调优  
3. Ribbon负载均衡⼯作原理/负载均衡算法IRule  
4. Hystrix资源隔离、限流、熔断、降级  
5. Hystrix的线程池隔离技术/信号量隔离技术  
6. Hystrix执⾏时的8⼤流程步骤以及内部原理

分布式事务实践模块部分必看：  
1. 事务的基础知识：ACID以及⼏种隔离级别  
2. 事务的基础知识：Spring的事务⽀持以及传播特性  
3. XA规范以及2PC分布式事务理论介绍  
4. 2PC分布式事务⽅案的缺陷以及问题/3PC分布式事务⽅案的理论知识讲解  
5. 理解CAP与BASE的基础知识  
6. 理解TCC分布式事务技术⽅案以及原理/TCC分布式事务执⾏流程  
7. 可靠消息最终⼀致性⽅案/整体架构以及核⼼流程设计  
分布式系统架构实战部分必看：  
1. 保证分布式系统的接⼝幂等性的⼏种常⻅⽅案  
2. Redisson分布式锁原理  
3. Redisson可重⼊锁/lua脚本加锁逻辑/watchdog维持加锁/锁的互斥阻塞/释放锁  
4. Redisson公平锁原理  
5. MultiLock原理/RedLock源码算法实现  
6. Zookeeper Curator框架介绍以及分布式锁⽀持

7. Zookeeper分布式锁可重⼊锁源码剖析  
8. Zookeeper分布式锁可重⼊读写锁源码剖析

JDK源码剖析系列部分必看：  
集合部分：  
1. ArrayList基本原理以及优缺点  
2. ArrayList数组扩容以及元素拷⻉  
3. LinkedList基本原理以及优缺点  
4. LinkedList双向链表数据结构  
5. HashMap数组、链表、红⿊树的数据结构  
6. HashMap优化后的降低冲突概率的hash算法  
7. HashMap put操作原理以及hash寻址算法  
8. HashMap JDK 1.8引⼊红⿊树优化hash冲突  
9. HashMap JDK 1.8的⾼性能rehash算法  
10. LinkedHashMap底层原理/有顺序的map数据结构  
11. TreeMap/HashSet/LinkedHashSet/TreeSet底层结构以及原理  
12. Iterator迭代器应对多线程并发修改的fail fast机制

并发编程部分：  
1. CPU多级缓存模型  
2. 总线加锁机制和MESI缓存⼀致性协议  
3. Java内存模型  
4. volatile是如何保证可⻅性/顺序性  
5. volatile的底层实现原理：lock指令以及内存屏障  
6. synchronized底层原理（jvm指令以及monitor锁）  
7. 可⻅性涉及的底层硬件概念：寄存器、⾼速缓存、写缓冲器  
8. 深⼊探秘有序性：Java程序运⾏过程中发⽣指令重排的⼏个地⽅  
9. synchronized锁同时对原⼦性、可⻅性以及有序性的保证  
10. 采⽤写缓冲器和⽆效队列优化MESI协议的实现性能  
11. AtomicInteger中的CAS⽆锁化原理  
12. AtomicInteger源码剖析：仅限JDK内部使⽤的Unsafe类  
13. AtomicInteger源码剖析：底层CPU指令是如何实现CAS语义的  
14. Atomic原⼦类体系的CAS语义存在的三⼤缺点分析/CAS的引发问题的解决⽅案  
15. AQS的原理(异步队列同步器)/以及AQS重要的参数  
16. AQS默认的⾮公平加锁策略的运作原理  
17. AQS队列唤醒阻塞线程的过程

18. ReentractLock如何设置公平锁策略  
19. ThreadLocal源码剖析：线程本地副本的实现原理  
20. JDK 1.7 HashMap并发环境下死循环之环形链表  
21. JDK 1.7 HashMap并发环境下死循环之死循环与丢数据  
22. ConcurrentHashMap底层原理：初始化流程  
23. ConcurrentHashMap底层原理：未分段数组的CAS加锁  
24. ConcurrentHashMap底层原理：链表和红⿊树解决hash冲突问题  
25. JDK 1.8对ConcurrentHashMap做出的锁细粒度优化  
26. CopyOnWriteArrayList：线程安全的List数据结构/基于写时复制机制  
27. CopyOnWriteArrayList核⼼思想：弱⼀致性提升读并发  
28. 线程安全的有界队列：LinkedBlockingQueue  
29. 基于数组实现的有界队列：ArrayBlockingQueue  
30. 线程池的核⼼成员变量有哪些/以及作⽤  
31. 线程池的源码执⾏流程  
32. 线程池的⼏个种类/区别/以及使⽤场景

⼤⽩话⽹络课程部分必看：  
1. 数据链路层：以太⽹协议、mac地址、⽹卡以及路由器  
2. ⽹络层：IP协议、⼦⽹划分以及⼦⽹掩码  
3. 传输层：TCP协议、Socket编程是什么  
4. 应⽤层：HTTP协议是什么  
5. HTTPS协议加密通信的实现原理  
6. 全世界⼏万台DNS服务器如何⼤接⼒完成IP地址的查询  
7. ARP⼴播获取路由器mac地址以及ARP缓存机制

公司的项⽬准备：  
1. 梳理⾃⼰做过⽐较复杂的或者最有挑战性的功能或者项⽬  
2. 把上⾯的功能或者项⽬画⼀下核⼼的流程图  
3. 把上⾯的功能或者项⽬⼀些功能点列⼀下，还有表结构串联起来  
4. 做完这些功能和项⽬难点在哪，从⾥⾯学到什么东⻄，⾃⼰回顾⼀下  
5. 梳理项⽬的时候，参考闲⼈⼤佬之前在群⾥分享的内容，⽐如架构班学员如何梳理项⽬，按照他们的思路去梳  
理项⽬。  
以上内容基本都是我⾯试前的准备，基本是我挑选过的⼀些重点知识。 有些课程之前看过，复习的时候过过笔记  
就⾏了，但⼤多时候，我会有重新看视频或者重新看专栏课的⽂章

当你复习完知识后，你⼼⾥⾯就有数了，哪些知识点⽐较扎实，⽐较熟悉。项⽬⾥⽤过哪些技术，线上问题怎么排  
查等等，这些都是很好的简历素材。  
举⼏个例⼦：  
JVM专栏课⾥⾯的知识你都理解透彻了，那么你的简历就可以写：  
熟悉JVM底层⼯作原理和垃圾回收机制，熟悉使⽤jstat、jmap、mat进⾏JVM调优  
MYSQL专栏课⾥⾯的知识你都理解透彻了，那么的简历就可以写：  
Mysql熟悉Innodb引擎、MVCC机制，能根据explain执⾏计划优化SQL  
你有读过Redission、zk分布式锁、SpringCloud的源码，那么你的简历就可以写：  
对开源技术有⼀定研究，对Spring Cloud、Redisson 、zk分布式锁等开源框架深⼊阅读过源码

上⾯的简历填充就是很好的技巧了，可以丰富你简历⾥⾯的个⼈总结和技术专业技能这些栏⽬了。  
项⽬经验的话，那么你就要突出项⽬的技术亮点，技术难点，技术栈，你负责的模块的细节，这些都要根据你实际  
的项⽬开发经验来写了，毕竟每个⼈的项⽬经验都不⼀样。  
很重要的⼀点是，我简历的内容，如专业技能和项⽬经历这些都是找⽼师帮我定制优化的，他给我提出⼀些专业技  
能和项⽬经历的优化建议，还有怎么丰富简历的内容，反复1-2次的调整与修改，我的简历就会“焕然⼀新”了。

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617623246247-1a4e1382-55cc-4d40-a043-013e155b2cbd.png)

6. ⾯试内容

根据⾃⼰的⾯试印象回忆，先归纳⼀下经常问的⼀些热点问题：

1. 线上某个程序CPU 100%，⼀般是什么原因导致的？怎么排查？讲讲排查步骤？  
问题分析：  
主要考你JVM的基础知识和⼀些JVM故障的排查命令。  
这些问题很简单，你看完JVM专栏课就知道对应的排查命令了，例如ps java进程的pid、Top -Hp、利⽤Jstack  
分析。这种CPU 100%出现的原因有很多，例如代码哪⾥没写好出现了死循环、⼀些连接池再调⽤之后，没有合理  
关闭等等。  
但你只是回答出这些内容，我觉得⾯试官觉得你只能拿到70分，刚好达到及格线。如果你想拿到90分+的话，必须  
继续分析出现这种问题的根本原因是啥？  
那你就可以继续带出JVM的堆内存相关知识点，例如新⽣代、⽼年代有没有合理的分配，java启动参数有没有合理  
指定⼤⼩，垃圾回收器有没有合理指定，出现问题的时候要合理的输出⽇志，线上可以⽤过jstat、jmap等命令定  
位出新⽣代、⽼年代的回收次数和哪些对象占⽤⽐较⼤。  
⼀步⼀步这样分析的话，让⾯试官知道你已经⾮常掌握到这块的知识了。

2. 有些sql执⾏很慢，怎么分析？要怎么优化？  
问题分析：  
主要考你sql的分析能⼒和优化能⼒。  
⾸先要打开mysql的慢查询⽇志，慢查询⽇志会统计出系统执⾏sql后出现的⼀些慢sql汇总，然后就拿出慢sql来分  
析了，看看对应的sql查询条件有没有⾛索引，如果没⾛索引就新建对应的索引就可以了。  
但你只是回答出这些内容，我觉得⾯试官觉得你只能拿到65分，刚好达到及格线。如果你想拿到90分+的话，必须  
告诉⾯试官后⾯怎么避免出现这种慢sql的问题，还有怎么深度调优？  
其实你看了Mysql专栏，都已经知道答案了。  
⾸先可以从innodb存储引擎⾥⾯的buffer pool⼊⼿，调优对应的buffer pool数量参数，然后继续把索引的结构  
B+树和原理讲解⼀次，避免查询的sql频繁的进⾏回表操作，还有主键的值是否是有序的，不建议是⽤uuid，如果  
使⽤uuid作为主键的后果是啥。然后继续讲⼀下使⽤索引的规则，⼏种索引的类型，怎样命中索引，怎么避免频繁  
回表。Explain分析sql语句的时候，type命中了哪个类型是最快的，type类型分了哪⼏类等等，如果你能继续带上  
分库分表的场景，那就锦上添花了。  
⼀步⼀步这样分析的话，让⾯试官觉得你对mysql很熟悉了。

3. 分布式锁你⽤过哪些？使⽤的时候要注意什么地⽅？  
问题分析：  
主要考察你对redis、redission、zk锁这块的知识点  
可以先从redis原⽣的分布式锁讲起，讲⼀下他的优缺点

然后再讲redission实现分布式锁的原理和机制：  
（1）加锁：在redis⾥设置hash数据结构，⽣存周期是30000毫秒  
（2）维持加锁：代码⾥⼀直加锁，redis⾥的key会⼀直保持存活，后台每隔10秒的定时任务（watchdog）不断  
的检查，只要客户端还在加锁，就刷新key的⽣存周期为30000毫秒  
（3）可重⼊锁：同⼀个线程可以多次加锁，就是在hash数据结构中将加锁次数累加1  
（4）锁互斥：不同客户端，或者不同线程，尝试加锁陷⼊死循环等待  
然后再讲⼀下zk锁，zk与redis做分布式锁的区别和优缺点  
zk锁的znode结构和核⼼的watch监听器机制  
这⾥顺便把zk锁的如何防⽌⽺群效应的思想也讲⼀下  
zk的zab协议的⼤概⽅案也讲⼀下  
已经回答的很不错了

4. 如何保证幂等性？  
这个问题rocketmq专栏课和架构课已经讲的很详细了，这⾥就不说了  
5. 讲下synchronized的锁升级  
这个问题我答不出来，主要是synchronized的锁升级没复习到这块，其实架构课⾥⾯都有讲，然后跟⾯试官卖  
惨，说没啥印象了，因为前⾯的synchronized原理已经回答的差不多了。  
⾯试后，我就⻢上的回顾了这块的知识了，⾯试不懂的问题，⾃⼰要记录下来，然后复习⼀下。  
（1）锁消除  
锁消除是JIT编译器对synchronized锁做的优化，在编译的时候，JIT会通过逃逸分析技术，来分析synchronized  
锁对象，是不是只可能被⼀个线程来加锁，没有其他的线程来竞争加锁，这个时候编译就不⽤加⼊monitorenter  
和monitorexit的指令。  
（2）锁粗化  
（3）偏向锁  
（4）轻量级锁  
（5）适应性锁

6. 讲下可靠消息最终⼀致性⽅案

这个基本是⼿撸画图给⾯试官看的，边画边讲解，详细的内容可以看看rocketmq专栏课和分布式事务的架构课内  
容 7.  
Eureka注册中⼼和Nacos注册中⼼和Zookeeper注册中⼼的区别  
讲⼀下Eureka注册中⼼是如何保证AP的/Eureka注册表的多级缓存机制。  
讲⼀下Zookeeper是如何保证CP的。  
讲⼀下nacos是怎样⽀持AP/CP的，顺便讲⼀下nacos集成了配置中⼼的功能。  
这⾥说⼀下，我对nacos不是很熟悉，但知道他的⼤概特性，讲nacos的时候顺便也带⼀下现在⽐较流⾏的Spring  
Cloud Alibaba那套，⾯试前也复习了⼀下nacos的思想，应付⾯试官毫⽆压⼒。

根据⾃⼰的⾯试印象回忆，讲⼀下⼀些开放性题⽬：  
1. 讲⼀下你⾃⼰做的最复杂或者最难的功能。  
这个要根据⾃⼰的项⽬经验和业务模块来讲，我的建议最好是挑最近的公司的项⽬来准备，因为最近公司的项⽬根  
据⽬前时间来说你是最熟悉的。  
你⾃⼰要准备项⽬⾥⾯的1-2个⽐较复杂的功能，要理解⾥⾯的细节，最好⾃⼰⼿画⼀下流程图，因为问这种问题  
的⾯试官，往往会抠你项⽬的细节，如果你不知道项⽬的细节的话，你会被⾯试官问的不知道如何回答，这时候就  
会很尴尬。  
2. 如果要你⾃⼰设计⼀个rpc框架，你要考虑哪些点？  
这个主要考察你对框架设计的总体能⼒，例如框架的可⽤性，可扩展性，可读性，可伸缩性  
然后也讲讲市⾯上⼀些⽐较流量的rpc框架，不同rpc框架他们之间的区别，以及他们是怎么保持上⾯的⼏个性的

3. 如何保证系统的⾼可⽤、⾼并发？  
这种问题就最好回答了，看过专栏课、架构课后，这些问题其实没啥压⼒。  
可以从最上层开始慢慢的剖析，如服务器⽤了Lvs + nginx + keepalive的负载均衡架构，LVS服务器，作为负载  
均衡调度器，请求到来了以后，直接基于linux内核内部的⼀些底层机制进⾏请求转发，转发给后端的Web服务器

池⼦⾥的⼀台服务器，本质上就是在进⾏负载均衡，⽽且因为LVS主要是基于linxu内核级的⼀些底层机制做请求转  
发，所以说效率极⾼，单机抗每秒⼏⼗万甚⾄上百万吞吐量绝对不是问题。  
然后就带出MQ异步、MQ削峰、防⽌消息堆积，幂等性处理、多级缓存、Redis Cluster、防⽌缓存雪崩、防⽌缓  
存穿透、防⽌缓存击穿、熔断降级技术、分布式锁、分布式调度、分库分表等。

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617623451677-535d60b3-8305-407e-bf31-ad910f2e2cbc.png)

⾯试官提问:  
1. 问你索引的原理，你就可以⽤之前准备的A4纸⼿撸B+树和数据⻚和索引⻚的结构给⾯试官看，有看过mysql专  
栏的话，基本没难度的。  
2. 问你Eureka服务发现与感知为什么这么慢，怎么调优，你就可以⼿撸Eureka的多级缓存机制以及各模块的时间  
的图，然后逐个功能点讲解怎么优化参数了。  
3. 不管⾯试官提问啥，你都可以再纸上⾯边讲边画图给⾯试官看，我都是这样做的，效果很好。  
⾯试完：  
⾯试完后，你可以听回你⾃⼰的⾯试录⾳。  
⾯试过程中你遇到不懂的问题，⾯试完你会印象很深刻的，那么建议你要⻢上记录下来，然后回到家复习⼀下知识  
点，结合⾯试录⾳和不懂的问题进⾏复盘。  
⾯试结果:  
⾯试⼀般通过了第⼀轮后，后⾯⼏轮都不难的，⾃⼰的⾃信⼼要⼗⾜。  
⼀般⾯试完后，1-2天内会有结果反馈，如果HR有加你微信那就更好了。  
如果⼀直没反馈，你可以主动联系HR去问结果，不管是通过还是不通过，总⽐你⼀直等待结果要好。  
因为不通过了，不⽤失望，失败很正常，反⽽你就更加有信⼼和毅⼒去拿下其他⼤⼚的offer了。  
第⼀周⾯试的公司，都是⾃⼰投的，⽤来练⼿的。  
第⼆周⾯试的公司，都是⼀些⼤⼚，例如唯品会，⻁⽛，荔枝。  
这些⼤⼚都是⾛内推的，都是靠⾃⼰的资源或者是架构班⾥⾯的⼴州的同学的资源⾛内推的  
准备⾯试前，要告诉⽼师，⽼师会拉你进去你该地区的跳槽交流群，⾥⾯有各个同学的公司资源。  
有⼀个⼩插曲，第⼀周再⽤拉钩投简历的时候，拉钩有个投了⼜投的功能，不⼩⼼点错了。导致把简历投到荔枝  
FM那了，但是⼀直没电话通知。  
第⼆周，我经过闲⼈⼤佬的内推帮助下，把我的简历直接推给他的前领导，才发现原来我的简历在拉钩被淘汰掉  
了，最后⽤⼈部⻔重新把我的简历捞回来，直接约⾯试。  
8. 内推⾯试  
儒猿技术窝 : apppukyptrl1086.pc.xiaoe-tech.com





链接：[http://note.youdao.com/noteshare?id=3eef287c32b9ece75473bbb43e4da596&sub=74C0D27593294E57AF8A3DF42028F8B5](http://note.youdao.com/noteshare?id=3eef287c32b9ece75473bbb43e4da596&sub=74C0D27593294E57AF8A3DF42028F8B5)

1、谈谈java继承

在开发过程中，有很多代码是重复，我们可以把公共的代码抽象出来作为一个父类，然后我们需要 访问父类的方法、变量的时候可以去继承这个父类。他一来减少了重复代码，二来当需要修改这些公公共的方法、变量的时候直接修改父类即可。但是这样也使得父子类产成了较强的耦合性、一旦父类被改变、子类也会跟着改变。当然、子类不能继承父类的私有方法/属性，在Java中默认的访问权限是protected 对子类可见、如果子类重写了父类的方法，权限修饰符不能比父类低。抛出的异常也不能比父类多。java不支持多继承，但是可以多级继承。

2、谈谈重写 跟重载 的理解，以及  各发生在哪个时期  编译or 运行 什么情况下 父类的方法不能被子类重写，以及子类的访问权限是有什么限制

重写：重写是发生在父子类之间的，当子类需要父类的功能时，但是子类又需要自己特有的内容时，可以重写父类的方法，方法的声明必须跟父类的一致，在重写的时候最好写上重写的注解@Overriy，防止我们因为不小心打错字符导致无法正确重写父类的方法。根据历史替换原则（子类可以扩展父类的功能，但不能改变父类原有的功能）重写的访问权限修饰符不能比父类的低，抛出的异常也不能比父类的多、必须返回相同的返回类型。

3、类加载机制，双亲委派机制、以及双亲委派机制的优点

1、加载：通过一个类的全类限定名来获取定义此类的二进制字节流，在内存中生成代表这个类的Class对象

2、验证：对Class文件做文件格式验证、元数据验证、字节码验证、符号引用验证等

3、准备：准备阶段是正式类中定义变量（static 修饰的变量）分配内存并赋初始值

4、解析：解析阶段是将常量池的符号引用替换为直接引用过程。

5、初始化：初始化是类加载的最后一步骤，初始化阶段就是执行类构造器方法clinit（）方法的过程，他不是虚拟机构造方法init（），这个要注意。执行的就是一些静态代码块，由于他会先之类父类的clinit（）方法，所以在子类执行的时候，会先执行父类的静态代码块。我们知道，Object类是所有类的父类，所以他一定是先执行，Object的clinit()方法，

    首先虚拟机加载class是按需加载的，在虚拟机需要加载一个class文件的时候，第一步加载阶段：通过双亲委派机制由系统类加载器->拓展类加载器->启动类加载器加载到class文件，然后进入链接阶段：验证：class文件的信息是否符合虚拟机要求->准备：为类的静态变量分配内存，并将其赋默认值-> 解析：将常量池中的符号引用替换为直接引用（内存地址）的过程，然后是初始化过程：为类的静态变量赋初值。

4、谈谈set集合的理解，以及他的一些方法，是否安全，以及它是有哪些排序，

Set是一个接口，继承Collection接口，实现这个接口的有Hash Set、LinkedHash Set、Tree Set。不安全

Tree Set使用自然排序

特点是不允许有重复元素，HashSet底层是hashMap实现，我们只打，利用map集合key不允许重复的特点使得set不能有重复元素，key就是set集合的元素、给一个默认的value(object).

5、说一下redis都有哪些 淘汰策略，默认是用哪种

noeviction: 不删除策略, 达到最大内存限制时, 如果需要更多内存, 直接返回错误信息(默认)

allkeys-lru：所有的key使用lru算法进行淘汰

volatile-lru：从设置过期时间进行lru算法进行淘汰

volatile-random：从设置过期时间随机淘汰

volatile-ttl：根据key的过期时间进行淘汰，越早过期的key越早被淘汰

allkeys-random：所有的key随机淘汰

补充：lru算法大致思路是随机抽取五个key(默认)，把从里面淘汰掉使用最少的key.

redis3.0做了一点优化，把第一次取的key放到一个候选池中(大小为16)，随后拿到的key空闲时间大于池中最小的时间才放进去，当候选池满了，会把候选池访问时间最大的那个key干掉，用来放新key

6、说一下redis 是数据类型 以及它的一些应用场景

redis的数据类型其实就是Redis的本地方法，使用合适的数据类型就是充分发挥Redis的性能。。。。。

String：应该是redis最基本以及最常用的数据结构了，一般用来一些，例如token、订单编号等热点信息,以及计数功能等

hash：我是这么理解的，就是一个相当于java的map，key对应的是一些对象，通过key获取到某个对象之后通过fileId（属性名）获取到对象属性值，然后进行对属性值的操作。可以用来存放商品信息，例如简单版的购物车

list: 这个列表就是简单的字符串双向链表，可以用关注哪些文章公众号，

set：可以计算集合交集、差集、并集、用来微信朋友圈点赞、微博好友关注社交关系、可能认识的人、抽奖（随机从集合中获取n个元素，可以删除 也可以不删除）。

zset：zset也是跟set一样是String元素不能重复的集合，他有一个元素权重（score参数）概念，

可以从小到大 也可以从大到小排好序返回，也可以指定分数范围排好序返回，可以用来做一下推荐例如抖音推荐、热门商品推荐等

8、刚刚你谈到使用随机过期的策略防止缓存雪崩，假设大量的数据随机到某一时间过期，还是会有大量的请求打到数据库，你有什么优化的思路或者方案

应该是为不同的key设置不同的缓存过期时间，可以防止某一时刻大量的key同时过期造成数据库压力过大奔溃

9、mysql 什么情况下会出现索引失效  怎么判断是否走索引（说一下 explain 解释器返回的字段都有哪些）  说一下覆盖索引 以及什么情况下会回标表查询

mysql在联合索引的情况下跳过前面的索引条件下会出现索引失效

1.有or必全有索引;

2.复合索引未用左列字段;

3.like以%开头;

4.需要类型转换;例如你的字段是int类型，你不小心打多了一个双引号导致mysql需要类型转换

5.where中索引列有运算;

6.where中索引列使用了函数;

7.如果mysql觉得全表扫描更快时（数据少）;

explain关键字，下面讲常用的字段

![](https://cdn.nlark.com/yuque/0/2021/png/2725209/1617974940675-3b7c856b-bcc6-47ad-bd46-5938ecf1e7cf.png)

selete_type：

simple:简单的查询，不包含子查询或者union查询

primary：如果sql包含任何子查询，那么子查询的最外层被标记为primary

table:这是哪张表的数据

type(重点关注)：有没有走索引，以及走了哪种索引

all：扫全表，没有走索引。

index：将所有的索引树都遍历一边才找到数据

range：对某个索引进行范围查找

ref：不是主键索引，也不是唯一索引，就是普通的索引，可能会返回多个符合数据的行，例如where name='张三'

eq_ref：在多表查询中，只命中t1、t2一条记录，例如 select * from t1,t2 where t1.id = t2.id 查询的条件一般都是主键索引 或者是唯一索引，这样才能保证只有一条记录。

const：把主键索引当where 来查 只匹配一行数据，索引一次就找到数据了，即不用回表

prssible_key:可能用到的索引

key:实际用到的索引

row：根据索引以及表的情况大致分析需要读取的行数，行数越小越好

extra:

using fileSort ：文件排序，在order by 或者group by 排序过程中，order by 的字段不是索引字段，会出现文件排序。

using temprorary：使用了临时表保存中间结果，常见于order by 或者 group by 中

using index：表示在select 中使用到了覆盖索引。

10、谈谈你对mysql事务的理解，默认是使用哪种隔离级别，能否解决幻读

为了解决并发问题提出来悲观锁和乐观锁的思想，乐观锁基于版本实现，悲观锁就是事务了，事务默认的隔离级别是可重复读，并发下不能解决幻读

11、现在有一张表 test 里面有四个字段 a b c d  ,b c d是联合索引 请判断下面的sql是否走了哪些索引,并说出原因

1、select * from test where b=1 and c>1 and d=1   

2、select * from test where d=1 and c=1 and b=1 

3、select * from test where d<1 and c=1 and b=1 

1、只走了b、c 索引，跟索引的结构有关（B+树），他首先先根据 b = 1 c= 1,锁定了区间，然后在这些区间的右边（我们知道B+树是特点是左节点的数据是要比有节点的数据要小的）数据里面比较所以的数据。直到找到c=1位置。

2、走了三个索引，b c，d ,因为mysql的执行优化器 会帮助我们优化调整条件的位置，最后会被优化成为联合索引的顺序。

3、也走了b、c两个索引，根据上面说的，会帮我们优化调整位置。

12、说下springboot 核心配置文件、注解

@SpringbootApplication，主要由这三个注解组成，

@componentScan :这个注解的作用是说告诉spring扫描哪个包下的类，加载符合条件的组件、如果默认不写，则从从声明@ComponentScan的类所在的类下所有的包经行扫描，所以启动类最好是在跟包类的根目录下。

@EnbleAotuConfiguration：这个注解的主要作用是开启自动配置，里面的@Improt注解是核心，这个注解会加载@AotuCongfigurationImportSelector类，然后就会触发这类的selectImport方法，根据返回的string数组（class配置类的名称）加载配置类

@springbootConfiguration这个类继承至Configuration，标注当前是配置配置类，并将内部类内声明一个或者多个以@Bean注解标记的方法示例纳入到spring容器中，实例名就是方法名。常用来配置线程池对象、mq、redis、mongo等连接对象的管理

13、结合业务说下你是怎么对jvm进行调优的

14、redis 的持久化方式都有哪些、分布式锁

15、说一下mysql、redis、mongo的主从复制、集群、哨兵这些模式

16、dubblo服务的容错、降级，缓存的雪崩、穿透

17、jvm的内存模型

18、怎么解决跨域问题

19、codereview是怎么进行的，有用到什么工具吗

20、用到哪些线程池，

21、mybatis 一二级缓存区别 ，优缺点

22、谈谈对AQS的理解，以及尾分叉

23、说一下重量级锁到轻量级锁的过程、什么是适应锁

24、concurrentHashMap 底层结构，以及为什么说他是安全的，jdk7跟jdk8有什么区别

25、谈谈cas理解，以及他的优缺点， 跟Longadder有什么区别

26、快速失败？安全失败？

27、创建线程都有哪些方式？CompletableFuture?

28、谈谈对IOC、DI理解

IOC(控制反转)，把传统上由程序员通过代码去管理操控对象的权利交给容器去做，通过容器来控制对象组件的装配和管理。spring的ioc负责对创建对象、管理对象（通过ID[依赖注入]）的整个生命周期，优点是不用再由代码层面去维护对象的关系减少代码量，解耦。

他的原理其实就是利用了工厂模式+反射机制：

**29、Spring常用的设计模式，说说你对他们的理解，以及在spring中哪里用到了**

**30、mvc：说一下一个请求到服务后端到响应的全过程**

用户发送请求到前端控制器DispatcherServlet，DispatcherServlet接收到请求后，再调用HandlerMapping根据url去获取handler ，并返回给前端控制器，前端控制器在调用HandlerAdapter

处理器适配器，适配器经过适配调用具体的处理器，也就是我们写的辑去处理，执行完之后返回ModelAndView给给前端控制器，前端控制器再调用视图解析器ViewResolver进行

**31：springcloud常用的组件有哪些以及他们分别是做什么的**

**32：Eruka：自我保护机制是？**

**33：zookeeper 节点 都有哪种状态，监听机制，ZBA协议，启动选举跟宕机选举有什么不同，假设现在有zk有三个节点，突然挂了一台，请问服务还可以用吗，为什么？一个节点最大能存多少数据？master节点有什么作用？**

**34、hystriy：说下hystriy是这么做限流，降级，熔断、隔离、监听的**

**35、http：说下tcp的三次握手、怎么拆包，粘包的**

**36、Netty和NIO**

**37、mysql 优化流程**

**38、extra？ using filesort? using temporary ? ---->优化**

**39、聚簇索引 ？ 非聚簇索引？**

**40、mcvv**

**50、意向锁、间隙锁、**

**一个对象在失去链路引用的情况下，JVM是怎么进行回收的？**

**聊一聊JMM**

**聊一聊redis为什么那么快？**

**reids有事务吗，redis的事务是怎么进行的？**

**通过explain查看sql执行日志去优化sql的时候，除了type这个字段还有哪个字段可以参考索引的使用情况？**

**接口为什么是单继承，单继承除了JAVA，还有哪几种语言是单继承的？**

**eureka是怎么进行服务注册的，eureka是保证CA还是AP？**

**网关的本地缓存注册表什么时候过期？**

**hytrix是怎么进行熔断的？**

**解析一下spring Cloud的三大特性？**

**spring的底层事务是怎么进行的？**

**一个守护线程怎么保证它的高可用？**

**问了设计模式，然后让你在黑板画出类图**

**hashMap的数据结构是什么，链表什么时候转成红黑树？**

spring容器加载过程

mat大对象怎么找出来，并优化掉

死信队列

mq确认机制保证数据不丢失

mq路由算法

分布式锁

setnx，watchdog，可重入锁，lua

红锁可以解决集群问题

服务熔断，熔断配合降级使用

mongo为什么快，相对于传统数据库优缺点

mongo数据结构

死信队列

mongo模式分片，集群，副本集

什么情况下用分片，什情况下用副本集

分片键，怎么选择，还可以选择什么做分片键

线程池怎么线上调整，用调用量测试优化，推送最大线程数满了，为什么不用里面的拒绝策略

推送量多少，设置线程池解决推送什么问题

分布式id

雪花算法

数据库id

mysql里的json串怎么通过mybatis转化成java bean    typehandler。

mysql怎么转移到mongo  。

数据量小，主外键直接存入。大的话生成中间表在存入。

垮库查询，不建议这么做，一个库挂了会影响到别的库，隔离性，数据库单子职责。

只做消费数据，没有大概了解其原理，大概说一下里面的概念

对象头有moniter开始说

concurrenthashmap从1.7锁分段，1.8锁节点优化他，1.8为什么用synchronize，因为进行了锁优化

set数据结构，有什么功能去重的功能，允许值为空？，底层是hashmap

hashmap，key，value格式，有允许为空功能？key，value可否为空，默认是16，扩容是多少等等，数组加链表，什么时候转红黑树等等，1.7和1.8区别。后面问到再回答

volatile写和读，能保证什么性，可见性大概是怎么样的，吹jmm，主内存拷贝到工作内，工作内存处理好后就同步回主内存。

索引，是b+树，他是平衡多叉树，查找是logh，并且与平衡二叉树对比他的高度低，比他的深度低，他的叶子节点，非叶子节点，所经历的io次数少。说双向链表查询效率快。千万的数据只需3次io，这是其他红黑树做不到的。

四个级别

比较熟悉那个rr。是mvcc和next-key lock解决部分幻读，介绍下mvcc的多版本并发控制，怎么维护多版本，里面的trx-id和row-id和roll-point的指针是怎么找的。

问的怎么维护多版本在引出读和写的问题。之后引出快照读和当前读。引出read view视图

线上工作场景，没遇到过的话，就引导进其他领域。例如有没遇到内存泄露，没有，但是知道threadlocal的场景

Jvm的创建

mq模式

同步和异步

线程池的工作原理

wait和sleep

mybatis工作原理，懒加载

spring的源码

生命周期

mysql索引

redis对系统的热点数据进行保存复用，因为每次查库会很消耗数据库压力

数据库表设计，三个范式

2线程池定长   耗时长的和不定长  运行快的场景.

3.queue，ConcurrentLinkedQueue

BlockingQueue  阻塞算法ConcurrentLinkedQueue，非阻塞算法

是否线程安全

4.索引失效  

选择区分度较高的建立索引

复合索引最左前缀匹配原则

=和in可以乱序

索引不能参与列计算

尽量扩展索引，不要新增索引

5.ioc设计模式   工厂和反射    di 模板方法，观察者模式

6.索引数据结构

7.数据库存json可行吗

jdbc怎么解决插入1万条数据

mvcc的锁范围

redis的命中率

怎么看堆内存有没溢出

mybatis懒加载

频繁GC，访问量高时，有可能造成频繁的GC、甚至FGC。当调用量大时，内存分配过快，就会造成GC线程不停的执行，导致CPU飙高

序列化与反序列化，例如应用代码执行xml解析时，调用量增大的情况下，可能导致了CPU被打满

线程上下文切换、当启动了很多线程，而这些线程都处于不断的阻塞状态（锁等待、IO等待等）和执行状态的变化过程中。当锁竞争激烈时，很容易出现这种情况

某些线程在做无阻塞的运算，简单的例子while(true)中不停的做运算，没有任何阻塞。写程序时，如果需要做很久的计算，可以适当将程序sleep掉

springboot如何加载



1 mysql和oracle有什么区别

2 oracle怎么做分页

3 mysql事物实现原理

4 mysql可重复读事物，事物快照生成时间？

5 mysql b+tree联合索引，为什么出现了范围查询，后面的索引就失效了。

6 怎么优化sql

7 当横向分表的时候，如何跨表查询

8 当纵向分库的时候，怎么垮库查询

9 mysql主重同步实现原理

10 mycat实现原理

11 什么情况下用mogodb 什么情况下用 mysql

12 redis与mogodb有什么区别

13 redis常用数据类型有哪些，常用数据类型的底层数据结构是什么

14 redis setnx和set有什么区别

15 redis是怎么保证脚本原子性执行的

16 redis是如何单线程，却能有QPS,TPS 10万/s 是如何做到的

17 redis set一个值的时候 redis内部流程是怎么跑的

18 redis有哪些集群模式，集群实现原理，对应的优缺点是什么

19 redis分布式锁怎么做

20 redis集群分布式锁 上锁的时候 master上成功了 salve还没有同步 此时master已经死亡，这种情况如何处理

21 zookeeper怎么做分布式锁

22 zookeeper怎么实现负载均衡

23 zookeeper实现原理

24 dubbo和spring cloud有什么区别

25 dubbo rpc调用中 服务消费者调用服务提供者的底层流程是什么

26 springioc aop mvc 源码 原理

27 springboot实现原理

28 rpc远程调用失败怎么处理

29 Hystrix是如何实现服务降级、隔离、熔断、限流的

30 强一致性和高可用性如何抉择

31 分布式配置中心 springcloud-config和apollo有什么区别 他们的优缺点是什么

32 springcloud-config通过消息总线使用mq通知配置变更，但是服务器数量过多导致消息延迟到达，服务使用了老的配置怎么处理

33 apollo因为网络原因导致服务器获取配置失败怎么处理

34 java线程池线程池参数有哪些 实现原理

35 如果线程池线程走了拒绝策略了，这个时候Future.get会发生什么

36 如何设定线程池数量

37 常用java集合原理 哪些线程安全哪些线程不安全

38 ConcurrentHashMap，HashTable 在实现线程安全上有什么区别

39 cas是如何实现的

40 什么情况下用乐观锁，什么情况下用悲观锁

41 synchronize和ReetrantLock有什么区别 实现原理是什么

44 cas怎么解决aba问题

45 Volatile有什么作用 实现原理是什么

46 用数据库怎么实现分布式锁

47 LinkedBlockingQueue实现原理

48 CountDownLatch实现原理

49 jvm内存模式介绍

50 新生代和老年代默认比例

51 eden和from,to的默认比例

52 一个小对象一直存活，他是怎么在堆内存中变动的

53 如何确认一个对象是否存活

54 cms实现原理 g1实现原理

55 如何优化

56 线上出现了java导致的cpu 100%， 如何定位 如何处理 。可能是什么故障原因

57 threadlocal实现原理

58 一个分布式调用链上出现了性能问题，如何定位，如何优化

59 常用mq有哪些，他们的区别是什么

60 mq怎么防止重复消费

61 kafka是如何保证高并发，高性能的

62 uuid是怎么实现的

32位系统与64位系统的区别？？、

Canal 这个开源框架暂时是没有实现集群这个功能的，那么面试官就问了：

-   你如何去改造这个项目，从而实现 Canal 的集群功能？

一面

• 介绍

• 数据库相关 , innodb和myisam区别

锁粒度 , 索引的结构 , 事务方面

• 说一下b+树

• 可重复读的实现

mvcc , 历史版本指针相关那一套

• 幻读的解决

next-key lock

• 怎么用索引,举个例子

慢查询日志 , 针对查询慢的sql语句,根据最左匹配原则等去建立合适的索引

• binlog说一下

binlog是mysql实现的二进制日志文件 , 一般用于crash-safe , 我之前还用他来做过缓存和数据库的双写一致性 , 用阿里的canal去订阅binlog,数据库更新的时候顺带删除redis缓存

• binlog的几种格式说一下

一个是statement, 一个是row , 还有一个mix混合模式 , statement没办法复原一些函数操作 , row数据量会比较大 , 所以有mix模式,不涉及函数的操作就用statement , 不然就用row

• redis的数据结构 , 挑几个说一下

String的SDS , list的压缩列表 , zset的跳表

• hash的时间复杂度分析一下

首先我不太记得hash的结构是怎么样的....我猜测是链表 , 那么定位桶的时间复杂度是o(1) , 如果有hash冲突的情况下还需要遍历链表 , 有一个o(n)的开销

• MQ说一下

我一般用的多是rocketMQ , kafka没用过,但是我知道他吞吐量比较大,会积压信息 , 一般用来做日志比较多

• 怎么解决MQ重复消费的问题?

可以写入redis , 或者是存入到mysql中 , 设置唯一键

• https

非对称加密 - ca证书验证 - 对称加密传输

• 为什么不直接使用非对称加密传输

非对称加密慢,消耗资源

• TCP四次挥手,各个阶段的状态

重点说了time_wait和last_ack , 以及各个阶段没收到数据包会执行什么操作

• get和post的区别

本质上是一样的 , 只是浏览器针对get和post进行了不同的处理 , post回退有害, 编码可以使用二进制 , 数据不放在url等, get默认可缓存 , 参数可以放在url,能直接在浏览器地址栏发起请求等 , 然后给他说了下啥是restful风格

• 抓过包么

抓过,使用的叫fidller?之前写过一个校园查询水电网页webapp,就是抓包做的, 具体给他讲了这个app实现了哪些功能

• 会go? 说一下切片和数组的区别

喜欢go,之前学过一点,但是不太记得了

• 项目上的那个RPC框架说一下

就说了下写了目前实现了哪些功能, 之后要实现哪些

• 说一下实现的RPC协议

比较简单,前几位是魔数 , 然后接一个request/respon标志位 , 序列化标志位 , 数据包大小

• 限流怎么做

再加个滑动窗口 , 漏桶或者令牌桶就行,不过我觉得还是单独弄个限流中间件是不是要好一点?

• 很多rpc框架其实都是自带限流的 , 你在实习的时候有没有用到过

没有 , 我实习只接触到了自研的orm框架

• 说一下AOP

老八股

• 有在linux操作过把?说一下查看权限

我一般直接用ll查看

• 那你说一下640是什么权限

g了,不记得了,我只知道这些权限是二进制位表示的 , 但是怎么排列的我给忘记了...

• 怎么给他加执行权限

chmod +x

• 能转go吗?

能,太能了,挺喜欢go的,只是现在上了java的贼船 , 只能用java来面试了

• 面试官笑了 , 其实语言这个东西对校招来说不是特别重要

我不敢 , 我怕我说我会go被吊锤

• 怎么看你很轻松随意

我一直都是这样的 , 面试官你放轻松

• 还有什么想问的吗

没了,你还有什么想问我的吗?

8/23 二面

随便聊了几下项目还有个人学习经历

面试官说一面的面试官应该和我聊了比较多技术问题了 , 他比较喜欢聊天, 让我跟他聊天

最后看了一下我的leetcode说就不给我出算法题了....

赶着去吃饭二十分钟就结束了...

3 Java三大特性

4 Jvm虚拟机 内存结构、算法、垃圾回收

5 集合类 链表和数组的区别 map和set的区别

**主要考察对集合类源码的理解**

6 二分查找代码

7 mysql相关的问题

8 spring

9 前后端数据交互

10 网络、操作系统

1 http的数据包格式

2 tcp包含ip么

3 tcp的数据包格式

**腾讯确实很喜欢考计算机网络，我当时对这块基本没准备，挂的很彻底。**

4、mysql数据库连接池的驱动参数

5、数据库连接池如何防止失效

6、部署项目时tomcat 的参数

**问的角度有点刁钻，当时没答上来，感觉有点劝退的意思。**

7 热加载的原理

8 mybatis的#和$号区别

9 java的jdk源码

10 hashmap的iterator读取时是否会读到另一个线程put的数据

**这个是不会的，迭代器在迭代时如果集合类插入新元素，modcount会变化，此时迭代器的迭代过程应该会失败退出。**

11 Linux的显示文件夹大小 ls -al

12 Linux的查看端口状态 natstat加参数

13 linux的查看进程的启动时间 linux ps

**好吧，这就是腾讯第二喜欢的操作系统和Linux。**

3 java的堆和栈

4 内存泄漏发生在哪

5 设计模式 工厂模式 单例模式 举例子

6 mysql数据库 实现层级树形结构 引擎 索引 查询优化 多方面

**这些面试题跟之前面试遇到的没有太大区别，但是答得并不是很好，因为我那时候对有些知识点的理解还是停留在表面，所以时间一长马上就忘了。这方面不知道各位有没有同感。**

7 微信红包的设计 开发 注意 用户数据的统计 项目相关

**不是很常见的面试问题，主要考察系统设计方面的知识，没答好。这道题网上也可以找到答案，一些常见的系统设计场景题例如：秒杀系统，直播系统，大家平时也可以稍微了解一下。**

1项目ssm

2mybatis与hibernate比较

3快排和冒泡

4hadoop redis

**这个当时还不会，连基本概念都不晓得。后来才开始慢慢重视这方面的学习**

5 Linux 显示文件属性 杀死进程 找出出现次数最多的ip linux指令

**打扰了，对Linux命令极为不熟悉，建议后端同学重视这方面内容的积累。**

6 sql中唯一索引的使用

**索引字段若相同则更新，不同则插入。**

7 hashmap的线程安全，性质

8 多线程的使用

9 同步解决线程安全但带来低效率问题。

10 map reduce过程

11 spring的几个特性

12 aop事务的隔离级别和传播特性

**默认隔离级别： ISOLATION_DEFAULT**

感觉答的还可以，但是没有回音，有点奇怪。

2 数据库设计

3 项目中并发使用，部署情况，测试情况

4 系统页面读取不一致，使用异常或者警告。

5 项目中的上传功能

**面试官对项目考察的挺多，好在我事先准备的比较充分，基本都打了上来。**

6 final finalize finally的用法和区别

7 hashmap原理

8 static作用域

9 大型系统的架构：高可用，高性能，伸缩性，扩展性。

**刚好之前看了《大型网站技术架构》这本书，把后端架构的基础理论搞懂了一些，所以面试官问起来也能比较好地回答。**

10 算法 二维数组求最大图形面积

11 SQL语句 查找

12 spring的核心原理：ioc aop di

**ioc：控制反转，松耦合，自动完成依赖注入。**

**注入方式：构造器，setter，接口。**

**实话说，当时对这块内容理解不深，主要靠刷面经来学习知识点**

13 hashmap线程安全 stringbuffer 和 stringbuilder.

**二面：**

1 项目经验

2 简历内容确认

3 两个智力题

甲有一个王和另一张牌，乙有两张牌，问甲拥有两张王的概率和乙拥有两张王的概率

**概率问题，不会做**

一个圆桌，两人放棋子，谁没地方放旗子谁输，问有没有必胜办法。

**先手放在圆桌中心则必胜**

**360 春招实习 电话面试**

**一面**

1 volatile 原理 使用 指令重排 内存屏障 保证内存可见性

2 项目

3 Java的特性 抽象类和接口区别

4 aop切面的功能 和继承的关系

**二面：**

1 Java的内存模型

2 Java gc 算法 垃圾收集器 分代 分区 参数配置

**Java程序运行时与内存模型的关系，堆中有实例，永久代保存类的信息，加载类后自动初始化静态内容，然后虚拟机栈进行操作，对象引用指向堆中的实例，实例需要调用对应方法。**

4 左移有序数组的二分查找

5 volatile的实现

6 cas操作的实现

**底层硬件支持，cas为一条机器码指令**

7 synchronize关键字的使用

8 lock的原理和实现，lock和synchronized的区别

9 写一个电梯需要用到的类和方法

**一道面向对象设计问题，常见的题目我还见过“写一个地铁需要用到的类”、“写一个饭店要用到的类”**

10 Java8新特性

**明年你们可能要掌握Java9的新特性了吧**

**蘑菇街（offer）春招实习**

**一面**

1 JAVA的jvm：内存模型、分代的介绍、每个代的操作，gc算法。

2 类加载器、双亲委派模型、双亲实现，反双亲设计，类隔离。

**这部分问的很深了，特别是最后两个问题，把我问懵了。当时面的应该是基础架构部门，所以做的技术偏底层，问题都比较有深度。**

3 hashmap实现、concurrenthashmap实现。

4 volatile实现，锁分类介绍、AQS介绍、公平锁非公平锁介绍。

**当时压根不懂AQS，对于锁的几种类型也不够熟悉（互斥锁，轻量级锁，偏向锁）。这部分内容强烈建议看《Java并发编程艺术》以及《深入理解JVM虚拟机进行学习》**

5 并发、并发中的threadlocal原理。

6 tomcat介绍

7 三个任务，每个任务id都为long类型，如何用一个long来表示三个任务都已完成，要求不能用countdownlauch。

**答案是：使用三个id相&，若为0则完成否则不完成。（位运算性质）**

8 NIO和BIO的区别

**当时对NIO和BIO的底层原理不了解，只会回答很浅显的区别，实际上需要更加深入去分析，BIO的本质是基于阻塞IO的socket完成通信，而NIO是基于IO多路复用来实现的，在Linux上的底层实现就是epoll。**

9 Spring的AOP和IOC

10 使用一个数组实现map，可以用i存key，i+1存value。

11 使用一个数组实现一个链表，i存自己下标，i+1存下一个结点下标，i+2存值。面试官要求使用移位操作。没答上，转而提问了问题7.

酷家乐（一家创业做家装的创业公司，面试体验非常好，但二面约的时间和一个现场面试冲突了没面）

电面：

说说你印象最深的项目（异步队列）

在项目中遇到了什么问题（数据库的设计、异步队列如何将事件传入）

说说对[redis](https://cloud.tencent.com/product/crs?from=10680)的理解（基于内存、I/O多路复用、单线程）

redis为什么要使用单线程（面试官补充主要是为了原子性操作）

redis有哪些常用的数据结构，项目中你使用了什么数据结构

说一下spring的了解，有几种注入方式，你们项目一般使用什么进行注入

项目的web.xml配置中dispatcherServlet和ContextListener是干什么的

mybatis使用情况，了解哪些，用了哪些标签

项目中用到了什么设计模式

项目使用了什么版本管理软件，在github学习什么开源项目没有

一道算法，有序数组里面数字可重复，给定一个数，找出该数的范围（第一次就想到了遍历，后面想二分查找改进）

汉诺塔问题

远景能源（新能源的土豪公司，招偏执狂，感觉面试官是有那么点特色的，抓着一个点死问）

电面：

类加载了解吗？类加载步骤，双亲委派模型。如果我写了一个java.lang.String类，怎么进行加载的，怎么跟原来的类进行区分的？

垃圾回收机制了解吗？哪些时间我们需要对垃圾进行回收，如果我有一台双核4g的机器，我该如何分配新生代和老年代的大小？

异常捕获了解吗？说说常用的，你在项目中用到了哪些类型的异常捕获？如果碰到了空指针那些异常你会怎么处理呢？

多线程怎么样？说说你项目中用到的并发

说说你最拿手的项目？说了redis异步队列，就问同步和异步的概念，异步需要怎么实现，需要回调函数吗

既然redis用到了缓存，那如果叫你自己实现一个缓存，你该如何实现？怎么考虑缓存过期这些问题？

电信IT研发（电信的互联网公司，有编制，待遇也不错，前面二十分钟基础感觉答的基本倒背如流的，问到架构不太会了）

单点登录怎么做的，session共享，session和cookie的区别

Bootstrap啥类型的，jQuery了解情况

JVM垃圾回收，新生代和老年代的垃圾回收，可达性分析

HashMap和Hashtable区别，HashMap添加的对象为什么要重写equals和hashcode

数据库了解多少，事务acid，事务操作，怎么加锁，分布式系统锁，选举

微服务了解什么，微服务治理，微服务之间通信

58同城（面试最差的体验，酒店超级差，闷的要命，安排还恶心，过去等了三小时，一面面的还不错，二面没问多少就挂了，好像都是c++岗，面试官不用Java）

一面：

手写快排

数据库引擎的区别，说说btree，手写联合查询sql

HashMap了解多少说多少

wait()和sleep()

事务举例

用过什么nosql，说说redis，topk用什么数据结构

数据库分表

情景题，高并发访问一个接口，如何检测传入字符串的相似度很高的？答了个布隆过滤器，说沾了边

二面

算法题给一个数组，如何把偶数放到左边，奇数放到右边？写完后说当两边顺序已经一致了，交换是否会出现问题，加个判断

说说数据库，聚合函数了解吗？

网络编程了解吗，http请求如何区分请求头和请求体？说了解一点nio的知识，nio指什么，同步和非阻塞的概念是什么？

说下注册的时候的检测，多用户怎么判定是否被注册

去哪儿网（面试最好的体验，第一天上午机试，下午就接到通知明天去面试。在一个去哪儿合作的小清新酒店面试的，所有面试官都特别好，遇到答不上来的会给你解答，三面完直接现场发offer，只要在十月三十一号之前把三方寄给他们就行，简直不要太良心。当时一面完的时候我说我计算机网络和操作系统方面不是特别好，一面面试官笑着说：没事，路还长呢，你去等二面吧。待遇呢给的确实偏低，不过还是由衷粉一波去哪儿）

一面：（30来分钟）

说一个自己比较深的项目 ，redis多消费者一起取的时候如果队列为空你怎么处理（答了CAS进行尝试，超过失败次数之后就进入睡眠，面试官说可以不用这么复杂~~为空时直接进行睡眠就行）

纸上手写Springmvc DispatcherServlet的大致实现（大概10分钟的样子）

数据库了解吗？聚集索引和非聚集索引的区别，存储引擎的区别？主键使用不重复的字符串会出现什么问题（插入的时候由于字符串不能像自增长的id一样连续，所以在磁盘上的位置不同）？

说说HashMap吧，然后讲了HashMap、ConcurrentHashMap 1.7、1.8的实现（讲的很详细，面试官觉得数据结构还不错）

然后问计算机网络咋样，我说很一般操作系统咋样，我说很一般

线程有哪些状态，怎么进行切换的。

二面：（40来分钟）

说一个比较深的项目，还是说的异步队列，问你这为啥要用redis做异步队列啊，我用线程池直接自己开一个队列跟这有啥区别。扯了一堆，扯了redis I/O多路复用模型，最后不太满意~~

然后又手撸了一遍Springmvc

然后问HashMap

最后说你用了这么多redis，叫你设计一个缓存，你该怎么设计，get和set的时间复杂度怎么算的（答了用LinkedHashMap实现，分析了一下LinkedHashMap但是也没怎么说清）

三面：（20来分钟）

谈下人生，当场发了offer

顺丰科技（最懵逼的一次面试，在品学楼一个教室面的，感觉极不正规。一个估计三十来岁但是看着可能四十多岁的大叔面的，完全get不到他的点）

一面：

进去跟hr面一样，谈人生（你最喜欢看哪本书，你觉得在华为学到了什么），全程基本没问技术，吹牛20分钟说可以走了

招银网络科技（招商银行下面的子公司，以前叫融博，负面新闻较多，今年在成都刚成立分部，由于是银行，笔试和面试都比较强调sql，面试偏重于数据库和项目。现场面在软件园那边的招商银行面的，当天直接三面，基本每个人都有三面。面试的感觉只有一个：不愧是银行，太壕了。在七楼面试，层高居然有5、6米高）

一面（电面15分钟）

说说对JVM的理解

Java程序初始化顺序

线程的创建

mysql主键和唯一索引的区别

说说最近的项目

如何实现session共享，用redis如何实现

说说微服务，微服务之间如何管理

二面（现场面30多分钟）

看项目中有前端的，先问了下前端的css的选择优先级

手写了一个查询sql

手写了一个双重检查单例，问spring是怎么实现单例的

springmvc的大致实现过程

项目里重要的地方

说说微服务

如果你不用redis来做队列，自己写你需要注意哪些方法

数据库存储引擎的区别

数据库优化会吗，说说常用的优化

三面（现场面30多分钟）

面试官看了简历觉得项目时间都不长，没有太多兴趣，全程带笑，叫讲项目的兴趣点。讲redis异步队列，吹吹原理。说这没啥用，你这单机redis还不如自己实现一个队列速度还快些呢，你用Java写一个类似的redis才厉害（当时有点懵逼，感觉这面试官可能不太懂技术）。然后笑着听我吹完了springmvc一套，最后问我微服务治理知道不，我就扯了点服务注册和发现的知识。

四面（现场面40多分钟）

女hr全程含沙射影带笑的问，别人好像都只面了20来分钟。。。由于是转行，问了我转行原因，学习、生活、教研室那些情况。

OPPO（广告部的工程师面的，面试官自我介绍时有个非常骚气的花名，整体问的比较开放，二面聊着聊着就挂了）

笔试题比较简单

一面（现场面20来分钟）：

面试官首先自我介绍，然后我自我介绍。叫先看成绩单，问我最喜欢哪一门课，这门课有什么特点（我嗅到了hr面的气息）

然后说先看下笔试题吧，你觉得笔试难不（我回答说不难就看到面试官在纸上写了个简单，感觉想教育我了），就问了http和https的区别，https加密的过程

Spring是什么啊，为什么用Spring啊？Hibernate是什么啊？Mybatis是什么啊？假如我现在要分库分表，我选哪个框架？（这没接触过啊。。）你为啥用Redis啊，Redis有哪些方法，Redis事务，Redis哪些方法有原子性，Redis和Kafka用什么区别啊？

Java虚拟机垃圾回收方面的知识，生存区为什么要有两个，空间担保机制是啥

一个32核，64g的linux服务器，硬盘是5TB，怎么统计一个1TB的文件中一个限定中文名和英文名出现的次数（我简单说了下使用流水线），问大概需要多久时间，估计一下，一分钟两分钟还是十分钟。（总而言之面试的问题全部都相当的开放，让你自己说）

二面（现场面20分钟）：

简单问了下项目，各个知识点都问了一点点。

海康威视（今年扩招特别多，面试相对偏水，面试官感觉技术很不错，问的问题完全不按套路来）

一面（现场面20分钟）

面试官特别扯，进来就问后面还有几个，我们稍微快一点吧。然后看了我的简历，就问前端的类选择器。

然后问Spring Boot啥概念，有啥优势。接着问Spring Data JPA是啥，咋用（面试这么久第一次问我这个）。我解释了一些JPA是个规范，面试官问你这JPA用的啥版本啊（懵逼，俩月没用了。。记不住了），然后又问JPA是哪个组织规定的啊（懵逼的说了sun、spring、apache。。实际是EJB3.0小组）

看你用了Redis，你这Redis咋用的，用过lua脚本没有（这个真没用过）

面试官继续问：你这Java虚拟机什么掌握的咋样啊（感觉可以开始表演了），结果我回答还不错的之后，面试官问：说说一个class文件的具体组成结构啊，要细（懵逼，这部分没怎么看，就说里面有魔数）。继续问：虚拟机是起解释作用吗，有编译作用吗（一堆不是常规套路的问题问的很懵）。

然后我说我模拟实现过Spring MVC，请让我表演一哈。面试官看完简历之后说，那你就说说用了哪些设计模式（？？？这怎么表演），回答了下之后又问我一个http的请求的组成结构，然后叫我说http的状态码，有多少说多少。（感觉这个面试官就在观察表情，看着你很会的那种就马上换话题，完全不按套路出牌。最后殴打完我之后说了句你基础还可以）

二面（现场面5分钟）

hr小姐姐直接问想去哪，想要啥待遇

京东（投的成都岗结果北京的面试官面的，一面面试官觉得我还不错，结果二面面试官在某天晚上深夜11点打电话来说面试一下，说自己还在公司里面。我和他都很意外我投的成都岗，但却是他们部门面试，估计特别缺人，问我能实习不，我说要做毕设不能实习就凉了。有点可惜，留成都京东还是很不错的）

一面（50多分钟）

Struts2和SpringMVC区别，SpringMVC有啥好处。SpringMVC的执行流程。一个网页从输入网址到显示经历什么过程？Cookie和Session的概念。Mybatis和Hibernate的区别。异常处理知道不？详细介绍了一下异常的分类并举例

Redis有哪些数据结构。支持事务吗？Redis分布式锁知道不？Redis能持久化吗，持久化有哪些方式，有什么特点？断电会丢失数据吗？谁更严重？

数据库熟悉不，数据库引擎有哪些，InnoDB和MyIsam有啥区别，索引知道什么，哈希索引和b+树索引有啥特点，说说b树和b+树，画画b+树的结构，b+树最下面存的是数据吗？下面的数据有序吗？

设计模式知道什么？项目中用了什么？回答用了策略模式，简单说了说。写个单例吧？写了个双重检查的单例。

数据结构学的咋样？说说HashMap吧，对比说了HashMap和Hashtable，详细说了HashMap，最后引到解决线程安全用ConcurrentHashMap.详细说了ConcurrentHashMap1.7、1.8的put和size方法的区别和实现。其中问了synchronized底层实现知道不，就回答了个monitor，其它不太清楚。然后CAS是啥，解释一下。

有并发经验没有？回答说没有，但是知道基本知识，看过并发编程的艺术。说说开启线程的几种方式吧？说说volatile？说说Happens-before原则？CountDownLatch知道不，解释下，什么情况下使用？

写个二分查找吧，递归的

做个智力题：8个球7个一样重的，有一个偏重，一个天平，如何两次找出偏重的小球

给了一张纸，写写项目中如何保证代码的鲁棒性和可扩展性？

你有哪些offer？然后介绍了下自己的部门.